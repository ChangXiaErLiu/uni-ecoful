{"version":3,"file":"ChatMessage.js","sources":["components/chat/ChatMessage.vue"],"sourcesContent":["<!-- ai聊天界面的消息区域 -->\r\n<template>\n  <view class=\"chat-message\" :class=\"{'user-message': isUser, 'ai-message': !isUser}\">\n    <!-- 头像，后续可以替换真实的 -->\n    <view class=\"message-avatar\">\n      <image \n        v-if=\"isUser\" \n        src=\"/static/avatars/user.png\" \n        class=\"avatar-img\"\n        mode=\"aspectFit\"\n      />\r\n\t  \r\n\t  <!-- ai头像 -->\n      <image \n        v-else \n        src=\"/static/avatars/ai.png\" \n        class=\"avatar-img\"\n        mode=\"aspectFit\"\n      />\n    </view>\n\n    <!-- 消息内容 -->\n    <view class=\"message-content\">\n      <!-- 消息头 -->\n      <view class=\"message-header\">\n        <text class=\"sender-name\">{{ isUser ? '我' : 'AI助手' }}</text>\n        <text class=\"message-time\">{{ formatTime(message?.timestamp) }}</text>\n      </view>\n\n      <!-- 消息体 -->\n      <view class=\"message-body\">\n        <!-- 用户消息 -->\n        <template v-if=\"isUser\">\n          <text class=\"message-text\" v-if=\"!isEditing\">\r\n\t\t\t{{ typeof message?.content === 'string' ? message.content : (message?.content?.content || '') }}  \r\n\t\t  </text>\n          <textarea\n            v-else\n            v-model=\"editContent\"\n            class=\"message-edit-input\"\n            auto-height\n            :focus=\"isEditing\"\n            @blur=\"saveEdit\"\n          />\n          <view class=\"message-actions\">\n            <view class=\"action-btn\" @tap=\"startEdit\" v-if=\"!isEditing\">\n              <uni-icons type=\"compose\" size=\"16\" color=\"#ffffff\" />\n              <text>编辑</text>\n            </view>\n            <view class=\"action-btn\" @tap=\"copyMessage(message?.content || '')\">\n              <uni-icons type=\"paperclip\" size=\"16\" color=\"#ffffff\" />\n              <text>复制</text>\n            </view>\n          </view>\n        </template>\n\n        <!-- AI消息 -->\n        <template v-else>\n          <text class=\"message-text\">\r\n\t\t\t{{ typeof message?.content === 'string' ? message.content : (message?.content?.content || ' ') }}\r\n\t\t  </text>\n          \n          <!-- 附件显示 -->\n          <view v-if=\"message?.attachments && message.attachments.length\" class=\"attachments\">\n            <view \n              v-for=\"(attachment, idx) in message.attachments\" \n              :key=\"idx\"\n              class=\"attachment-item\"\n            >\n              <uni-icons type=\"paperclip\" size=\"14\" color=\"#64748b\" />\n              <text class=\"attachment-name\">{{ attachment.name }}</text>\n            </view>\n          </view>\n\n          <!-- AI消息操作 -->\n          <view class=\"message-actions\">\n            <view \n              class=\"action-btn\" \n              :class=\"{'active': message?.feedback === 'like'}\"\n              @tap=\"handleFeedback('like')\"\n            >\n              <uni-icons \n                :type=\"message?.feedback === 'like' ? 'hand-up-filled' : 'hand-up'\" \n                size=\"16\" \n                :color=\"message?.feedback === 'like' ? '#10b981' : '#64748b'\" \n              />\n              <text>有用</text>\n            </view>\n            <view \n              class=\"action-btn\" \n              :class=\"{'active': message?.feedback === 'dislike'}\"\n              @tap=\"handleFeedback('dislike')\"\n            >\n              <uni-icons \n                :type=\"message?.feedback === 'dislike' ? 'hand-down-filled' : 'hand-down'\" \n                size=\"16\" \n                :color=\"message?.feedback === 'dislike' ? '#ef4444' : '#64748b'\" \n              />\n              <text>无用</text>\n            </view>\n            <view class=\"action-btn\" @tap=\"copyMessage(message?.content || '')\">\n              <uni-icons type=\"paperclip\" size=\"16\" color=\"#64748b\" />\n              <text>复制</text>\n            </view>\n          </view>\n        </template>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch, nextTick } from 'vue'\r\n\r\nconst props = defineProps({\n  message: {\n    type: Object,\n    default: () => ({})\n  }\n})\r\n\r\nconst emit = defineEmits(['feedback', 'edit'])\nconst isUser = computed(() => props.message?.role === 'user')\nconst isEditing = ref(false)\nconst editContent = ref('')\n\r\nwatch(() => props.message, (newMsg) => {\n  // console.log('消息更新:', newMsg)\n}, { deep: true })\r\n\r\nonMounted(() => {\n  // console.log('消息组件挂载，消息内容:', props.message)\n})\n\r\n\nconst formatTime = (timestamp) => {\n  if (!timestamp) return ''\n  const date = new Date(timestamp)\n  return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\n}\n\nconst startEdit = () => {\n  \n}\n\nconst saveEdit = () => {\n  if (editContent.value.trim() && editContent.value !== props.message?.content) {\n    emit('edit', props.message?.id, editContent.value)\n  }\n  isEditing.value = false\n}\n\nconst copyMessage = async (content) => {\n  if (!content) return\n  \n  try {\n    // #ifdef H5\n    await navigator.clipboard.writeText(content)\n    uni.showToast({\n      title: '已复制到剪贴板',\n      icon: 'success'\n    })\n    // #endif\n    // #ifdef APP-PLUS || MP\n    uni.setClipboardData({\n      data: content,\n      success: () => {\n        uni.showToast({\n          title: '已复制到剪贴板',\n          icon: 'success'\n        })\n      }\n    })\n    // #endif\n  } catch (error) {\n    console.error('复制失败:', error)\n    uni.showToast({\n      title: '复制失败',\n      icon: 'error'\n    })\n  }\n}\n\nconst handleFeedback = (type) => {\n  if (!props.message?.id) return\n  emit('feedback', props.message.id, type)\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.chat-message {\n  display: flex;\n  margin-bottom: 32rpx;\n  padding: 0 24rpx;\n  /* 移除固定高度，让内容决定高度 */\n  /* height: 70vh; */ \n  padding: 15rpx;\n\n  &.user-message {\n    flex-direction: row-reverse;\n    \n    .message-content {\n      align-items: flex-end;\n    }\n    \n    .message-body {\n      background: #6FB052;\n      color: white;\n      border-radius: 24rpx 24rpx 8rpx 24rpx;\n    }\n  }\n\n  &.ai-message {\n    .message-body {\n      background: #ffffff;\n      border: 1px solid #e2e8f0;\n      border-radius: 24rpx 24rpx 24rpx 8rpx;\n    }\n  }\n}\n\n.message-avatar {\n  width: 64rpx;\n  height: 64rpx;\n  border-radius: 16rpx;\n  overflow: hidden;\n  margin: 0 16rpx;\n  \n  .avatar-img {\n    width: 100%;\n    height: 100%;\n    background: #f1f5f9;\n  }\n}\n\n.message-content {\n  flex: 1;\n  max-width: 80%;\n  display: flex;\n  flex-direction: column;\n}\n\n.message-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 12rpx;\n  padding: 0 8rpx;\n}\n\n.sender-name {\n  font-size: 26rpx;\n  font-weight: 600;\n  color: #374151;\n}\n\n.message-time {\n  font-size: 22rpx;\n  color: #9ca3af;\n}\n\n.message-body {\n  padding: 24rpx;\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.08);\n}\n\n.message-text {\n  font-size: 28rpx;\n  line-height: 1.6;\n  white-space: pre-wrap;\n  word-break: break-word;\n  /* 确保文本可见 */\n  min-height: 40rpx;\n}\n\n\n.message-edit-input {\n  width: 100%;\n  min-height: 120rpx;\n  padding: 16rpx;\n  border: 1px solid #d1d5db;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  line-height: 1.6;\n  background: #f9fafb;\n}\n\n.attachments {\n  margin-top: 16rpx;\n  padding-top: 16rpx;\n  border-top: 1px solid #f1f5f9;\n}\n\n.attachment-item {\n  display: flex;\n  align-items: center;\n  padding: 8rpx 0;\n  \n  .attachment-name {\n    font-size: 24rpx;\n    color: #64748b;\n    margin-left: 8rpx;\n  }\n}\n\n.message-actions {\n  display: flex;\n  align-items: center;\n  gap: 24rpx;\n  margin-top: 16rpx;\n  padding-top: 16rpx;\n  border-top: 1px solid rgba(255, 255, 255, 0.2);\n  \n  .user-message & {\n    border-top-color: rgba(255, 255, 255, 0.2);\n  }\n  \n  .ai-message & {\n    border-top-color: #f1f5f9;\n  }\n}\n\n.action-btn {\n  display: flex;\n  align-items: center;\n  gap: 6rpx;\n  padding: 8rpx 16rpx;\n  border-radius: 20rpx;\n  background: rgba(255, 255, 255, 0.1);\n  transition: all 0.2s ease;\n  \n  .ai-message & {\n    background: #f8fafc;\n  }\n  \n  &.active {\n    background: #10b981;\n    \n    text {\n      color: white;\n    }\n  }\n  \n  text {\n    font-size: 22rpx;\n    color: #64748b;\n    \n    .user-message & {\n      color: rgba(255, 255, 255, 0.8);\n    }\n  }\n  \n  &:active {\n    transform: scale(0.95);\n  }\n}\n</style>"],"names":["computed","ref","watch","onMounted","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAkHA,UAAM,QAAQ;AAOd,UAAM,OAAO;AACb,UAAM,SAASA,cAAQ,SAAC,MAAM;;AAAA,0BAAM,YAAN,mBAAe,UAAS;AAAA,KAAM;AAC5D,UAAM,YAAYC,cAAG,IAAC,KAAK;AAC3B,UAAM,cAAcA,cAAG,IAAC,EAAE;AAE1BC,kBAAK,MAAC,MAAM,MAAM,SAAS,CAAC,WAAW;AAAA,IAEvC,GAAG,EAAE,MAAM,MAAM;AAEjBC,kBAAAA,UAAU,MAAM;AAAA,IAEhB,CAAC;AAGD,UAAM,aAAa,CAAC,cAAc;AAChC,UAAI,CAAC;AAAW,eAAO;AACvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,aAAO,GAAG,KAAK,SAAQ,EAAG,WAAW,SAAS,GAAG,GAAG,CAAC,IAAI,KAAK,WAAU,EAAG,SAAQ,EAAG,SAAS,GAAG,GAAG,CAAC;AAAA,IACxG;AAEA,UAAM,YAAY,MAAM;AAAA,IAExB;AAEA,UAAM,WAAW,MAAM;;AACrB,UAAI,YAAY,MAAM,KAAM,KAAI,YAAY,YAAU,WAAM,YAAN,mBAAe,UAAS;AAC5E,aAAK,SAAQ,WAAM,YAAN,mBAAe,IAAI,YAAY,KAAK;AAAA,MAClD;AACD,gBAAU,QAAQ;AAAA,IACpB;AAEA,UAAM,cAAc,OAAO,YAAY;AACrC,UAAI,CAAC;AAAS;AAEd,UAAI;AASFC,sBAAAA,MAAI,iBAAiB;AAAA,UACnB,MAAM;AAAA,UACN,SAAS,MAAM;AACbA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAChB,CAAS;AAAA,UACF;AAAA,QACP,CAAK;AAAA,MAEF,SAAQ,OAAO;AACdA,sBAAAA,+DAAc,SAAS,KAAK;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAEA,UAAM,iBAAiB,CAAC,SAAS;;AAC/B,UAAI,GAAC,WAAM,YAAN,mBAAe;AAAI;AACxB,WAAK,YAAY,MAAM,QAAQ,IAAI,IAAI;AAAA,IACzC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}