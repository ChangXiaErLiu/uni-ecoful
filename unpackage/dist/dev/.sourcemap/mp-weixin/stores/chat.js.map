{"version":3,"file":"chat.js","sources":["stores/chat.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { chatStream } from '@/services/request.js'\n\nexport const useChatStore = defineStore('chat', {\n  state: () => ({\n    sessions: [],\n    activeSessionId: 'default',\n    messageMap: {}\n  }),\n  \n  getters: {\n    activeSession(state) {\n      return state.sessions.find((item) => item.id === state.activeSessionId) || null\n    },\n    messages(state) {\n      return state.messageMap[state.activeSessionId] || []\n    }\n  },\n  \n  actions: {\n    setSessions(list) { \n      this.sessions = list \n    },\n    \n    setActiveSession(sessionId) { \n      this.activeSessionId = sessionId \n    },\n    \n    upsertMessages(sessionId, messages) { \n      this.messageMap[sessionId] = messages \n    },\n \n    async sendMessage({ model = 'deepseek-chat', modelName = 'deepseek-chat', content }) {\n      const sessionId = this.activeSessionId || 'default'\n      if (!this.messageMap[sessionId]) this.messageMap[sessionId] = []\n \n      this.messageMap[sessionId].push({ role: 'user', content })\n \n      const aiMsg = { role: 'assistant', content: '' }\n      this.messageMap[sessionId].push(aiMsg)\n \n      await chatStream(\n        {\n          model, \n          modelName,\n          messages: this.messageMap[sessionId].map(m => ({ \n            role: m.role, \n            content: m.content \n          })),\n          stream: true\n        },\n        (delta) => { aiMsg.content += delta },\n        () => {},\n        (err) => { aiMsg.content += '\\n[错误] ' + (err.message || err) }\n      )\n    }\n  }\n})"],"names":["defineStore","chatStream"],"mappings":";;;AAG4BA,cAAW,YAAC,QAAQ;AAAA,EAC9C,OAAO,OAAO;AAAA,IACZ,UAAU,CAAE;AAAA,IACZ,iBAAiB;AAAA,IACjB,YAAY,CAAE;AAAA,EAClB;AAAA,EAEE,SAAS;AAAA,IACP,cAAc,OAAO;AACnB,aAAO,MAAM,SAAS,KAAK,CAAC,SAAS,KAAK,OAAO,MAAM,eAAe,KAAK;AAAA,IAC5E;AAAA,IACD,SAAS,OAAO;AACd,aAAO,MAAM,WAAW,MAAM,eAAe,KAAK,CAAE;AAAA,IACrD;AAAA,EACF;AAAA,EAED,SAAS;AAAA,IACP,YAAY,MAAM;AAChB,WAAK,WAAW;AAAA,IACjB;AAAA,IAED,iBAAiB,WAAW;AAC1B,WAAK,kBAAkB;AAAA,IACxB;AAAA,IAED,eAAe,WAAW,UAAU;AAClC,WAAK,WAAW,SAAS,IAAI;AAAA,IAC9B;AAAA,IAED,MAAM,YAAY,EAAE,QAAQ,iBAAiB,YAAY,iBAAiB,WAAW;AACnF,YAAM,YAAY,KAAK,mBAAmB;AAC1C,UAAI,CAAC,KAAK,WAAW,SAAS;AAAG,aAAK,WAAW,SAAS,IAAI,CAAE;AAEhE,WAAK,WAAW,SAAS,EAAE,KAAK,EAAE,MAAM,QAAQ,SAAS;AAEzD,YAAM,QAAQ,EAAE,MAAM,aAAa,SAAS,GAAI;AAChD,WAAK,WAAW,SAAS,EAAE,KAAK,KAAK;AAErC,YAAMC,iBAAU;AAAA,QACd;AAAA,UACE;AAAA,UACA;AAAA,UACA,UAAU,KAAK,WAAW,SAAS,EAAE,IAAI,QAAM;AAAA,YAC7C,MAAM,EAAE;AAAA,YACR,SAAS,EAAE;AAAA,UACvB,EAAY;AAAA,UACF,QAAQ;AAAA,QACT;AAAA,QACD,CAAC,UAAU;AAAE,gBAAM,WAAW;AAAA,QAAO;AAAA,QACrC,MAAM;AAAA,QAAE;AAAA,QACR,CAAC,QAAQ;AAAE,gBAAM,WAAW,aAAa,IAAI,WAAW;AAAA,QAAM;AAAA,MAC/D;AAAA,IACF;AAAA,EACF;AACH,CAAC;"}