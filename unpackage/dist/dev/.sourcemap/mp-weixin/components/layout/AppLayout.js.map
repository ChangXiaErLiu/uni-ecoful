{"version":3,"file":"AppLayout.js","sources":["components/layout/AppLayout.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvOTcyNDcvRGVza3RvcC91bmktZWNvZnVsL2NvbXBvbmVudHMvbGF5b3V0L0FwcExheW91dC52dWU"],"sourcesContent":["<!-- 主框架（UTF-8，中文注释） -->\r\n<template>\r\n\t<view class=\"AppLayout\" :class=\"layoutClass\">\r\n\t\t<!-- 顶部安全区占位 + 导航（移动端显示） -->\r\n\t\t<uni-nav-bar :title=\"navTitle.title\" v-if=\"!isDesktop\" statusBar fixed :placeholder=\"true\" :border=\"false\"\r\n\t\t\t:shadow=\"false\" height=\"42\" :backgroundColor=\"'#ffffff'\" :left-icon=\"showBack ? 'left' : ''\"\r\n\t\t\t@clickLeft=\"goBackSafely\" style=\"font-weight: bold;\" />\r\n\t\t<view v-if=\"isDesktop\" class=\"AppLayout__sider\">\r\n\t\t\t<NavSider :items=\"navItemsPc\" :current=\"activePath\" @navigate=\"handleNavigate\" />\r\n\t\t</view>\r\n\r\n\t\t<view class=\"AppLayout__main\">\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<!-- H5 端外层是否滚动由 contentScroll 控制，避免双滚动容器 -->\r\n\t\t\t<view class=\"AppLayout__content\" :class=\"{ 'AppLayout__content--no-scroll': !contentScroll }\">\r\n\t\t\t\t<slot />\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<!-- App/小程序默认外层滚动；如页面需自管滚动，可通过 props 关闭 -->\r\n\t\t\t<template v-if=\"contentScroll\">\r\n\t\t\t\t<scroll-view class=\"AppLayout__content\" :scroll-y=\"true\" enable-flex>\r\n\t\t\t\t\t<slot />\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</template>\r\n\t\t\t<template v-else>\r\n\t\t\t\t<view class=\"AppLayout__content\">\r\n\t\t\t\t\t<slot />\r\n\t\t\t\t</view>\r\n\t\t\t</template>\r\n\t\t\t<!-- #endif -->\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tcomputed,\r\n\t\tref,\r\n\t\twatch\r\n\t} from 'vue'\r\n\timport NavSider from './NavSider.vue'\r\n\timport {\r\n\t\tusePlatformInfo\r\n\t} from '@/utils/platform'\r\n\timport {\r\n\t\tuseSafeArea\r\n\t} from '@/utils/safe-area'\r\n\timport {\r\n\t\tnavTitleStore\r\n\t} from '@/stores/navTitle.js'\r\n\tconst navTitle = navTitleStore()\r\n\r\n\t// 组件入参\r\n\tconst props = defineProps({\r\n\t\tcurrent: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\t// 非 H5 生效：是否由 AppLayout 外层承担滚动\r\n\t\tcontentScroll: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t})\r\n\r\n\tconst emit = defineEmits(['navigate'])\r\n\tconst {\r\n\t\tisDesktop\r\n\t} = usePlatformInfo()\r\n\tconst activePath = ref(props.current)\r\n\tconst {\r\n\t\ttotalNavHeightPx\r\n\t} = useSafeArea()\r\n\r\n\twatch(() => props.current, (value) => {\r\n\t\tactivePath.value = value\r\n\t})\r\n\r\n\tconst layoutClass = computed(() => (isDesktop.value ? 'AppLayout--desktop' : 'AppLayout--mobile'))\r\n\r\n\t// 顶部占位样式（避免 fixed 导航遮挡内容）\r\n\tconst topSpacerStyle = computed(() => `height:${(totalNavHeightPx || { value: 64 }).value}px;`)\r\n\r\n\t// ====== 返回按钮判定与行为（仅优化返回功能，其他逻辑不改动）======\r\n\t// 中文注释：为避免影响现有功能，仅在移动端（!isDesktop）且非 Tab 页时显示返回图标\r\n\t// 规范化当前路径，确保以 / 开头，便于与 Tab 集合对比\r\n\tconst currentUrl = computed(() => {\r\n\t\tconst p = String(activePath.value || '').trim()\r\n\t\treturn p.startsWith('/') ? p : '/' + p\r\n\t})\r\n\r\n\t// Tab 页集合：用于判断是否显示返回按钮（这些页面不显示返回）\r\n\tconst TAB_PAGES = new Set([\r\n\t\t'/pages/home/index',\r\n\t\t'/pages/knowledge/index',\r\n\t\t'/pages/profile/index',\r\n\t])\r\n\r\n\t// 是否显示返回按钮（仅在移动端且非 Tab 页）\r\n\tconst showBack = computed(() => !isDesktop.value && !TAB_PAGES.has(currentUrl.value))\r\n\r\n\t// 安全返回：优先使用历史返回；无历史栈时按分类兜底\r\n\tfunction goBackSafely() {\r\n\t\t// 优先返回上一级（存在历史栈）\r\n\t\ttry {\r\n\t\t\tconst pages = typeof getCurrentPages === 'function' ? getCurrentPages() : []\r\n\t\t\tif (Array.isArray(pages) && pages.length > 1) {\r\n\t\t\t\tuni.navigateBack()\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// 忽略异常，继续兜底逻辑\r\n\t\t}\r\n\r\n\t\t// 兜底：个人中心子页 → 我的 Tab；其他子页 → 首页 Tab\r\n\t\tconst url = currentUrl.value\r\n\t\tif (url.startsWith('/pages/profile/') && url !== '/pages/profile/index') {\r\n\t\t\ttry {\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl: '/pages/profile/index'\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\turl: '/pages/profile/index'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl: '/pages/home/index'\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\turl: '/pages/home/index'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 桌面侧栏导航项（新增首页；其余功能保留为快捷入口）\r\n\tconst navItemsPc = [{\r\n\t\t\tpath: 'pages/home/index',\r\n\t\t\tlabel: '首页',\r\n\t\t\ticon: 'home'\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: 'pages/chat/index',\r\n\t\t\tlabel: 'AI问答',\r\n\t\t\ticon: 'chat'\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: 'pages/doc-generator/index',\r\n\t\t\tlabel: '报告生成',\r\n\t\t\ticon: 'compose'\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: 'pages/compliance/index',\r\n\t\t\tlabel: '报告审查',\r\n\t\t\ticon: 'calendar'\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: 'pages/knowledge/index',\r\n\t\t\tlabel: '知识库',\r\n\t\t\ticon: 'folder-add'\r\n\t\t},\r\n\t\t{\r\n\t\t\tpath: 'pages/profile/index',\r\n\t\t\tlabel: '个人中心',\r\n\t\t\ticon: 'person'\r\n\t\t},\r\n\t]\r\n\r\n\t// 统一跳转逻辑\r\n\t// - 目标为 tabBar 页面：使用 switchTab\r\n\t// - 其它页面：使用 redirectTo（可按需替换 navigateTo/reLaunch）\r\n\tfunction handleNavigate(item) {\r\n\t\tif (!item?.path || item.path === activePath.value) return\r\n\t\temit('navigate', item.path)\r\n\t\tconst url = item.path.startsWith('/') ? item.path : `/${item.path}`\r\n\t\tconst tabPages = new Set([\r\n\t\t\t'/pages/home/index',\r\n\t\t\t'/pages/knowledge/index',\r\n\t\t\t'/pages/profile/index',\r\n\t\t])\r\n\r\n\t\tif (tabPages.has(url)) {\r\n\t\t\ttry {\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t\turl\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\turl\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tuni.redirectTo({\r\n\t\t\t\turl\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t// 根据屏幕宽度控制官方 tabBar 显隐\r\n\t// - 桌面端（>=1024）隐藏底部 tabBar，仅显示左侧侧栏\r\n\t// - 移动端显示底部 tabBar\r\n\twatch(() => isDesktop.value, (val) => {\r\n\t\ttry {\r\n\t\t\tif (val) uni.hideTabBar()\r\n\t\t\telse uni.showTabBar()\r\n\t\t} catch (e) {}\r\n\t}, {\r\n\t\timmediate: true\r\n\t})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.AppLayout {\r\n\t\tdisplay: flex;\r\n\t\twidth: 100%;\r\n\t\tbackground-color: #f5f7fa;\r\n\t\tcolor: #1f2329;\r\n\t}\r\n\r\n\t.AppLayout__sider {\r\n\t\twidth: 350rpx;\r\n\t\tmax-width: 320px;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-right: 1px solid rgba(0, 0, 0, 0.08);\r\n\t\tbox-shadow: 4rpx 0 12rpx rgba(15, 23, 42, 0.04);\r\n\t}\r\n\r\n\t.AppLayout__main {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground-color: #f5f7fa;\r\n\t\theight: 100%;\r\n\t\tmin-height: 0;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.AppLayout__content {\r\n\t\tflex: 1;\r\n\t\tpadding: 24rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\theight: 100%;\r\n\t\tmin-height: 0;\r\n\t\toverflow: auto;\r\n\t}\r\n\r\n\t/* 当页面声明由自身管理滚动（如聊天页），H5 端需关闭外层滚动 */\r\n\t.AppLayout__content--no-scroll {\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.AppLayout--mobile {\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t/* #ifdef H5 */\r\n\t/* H5 高度策略：优先使用 100dvh，兼容 iOS Safari 地址栏收缩；提供 100vh 回退 */\r\n\t.AppLayout {\r\n\t\theight: 100dvh;\r\n\t\theight: 100vh;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t/* #endif */\r\n\r\n\t/* #ifdef MP-WEIXIN */\r\n\t/* 让小程序根节点有参照高度，百分比高度才能生效 */\r\n\tpage {\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.AppLayout {\r\n\t\theight: 100dvh;\r\n\t\theight: 100vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t/* #endif */\r\n</style>","import Component from 'C:/Users/97247/Desktop/uni-ecoful/components/layout/AppLayout.vue'\nwx.createComponent(Component)"],"names":["navTitleStore","usePlatformInfo","ref","useSafeArea","watch","computed","uni"],"mappings":"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"}