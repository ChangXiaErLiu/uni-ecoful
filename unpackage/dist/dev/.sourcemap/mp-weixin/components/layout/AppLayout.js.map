{"version":3,"file":"AppLayout.js","sources":["components/layout/AppLayout.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvOTcyNDcvRGVza3RvcC91bmktZWNvZnVsL2NvbXBvbmVudHMvbGF5b3V0L0FwcExheW91dC52dWU"],"sourcesContent":["<!-- 主框架（UTF-8，中文注释） -->\n<template>\n\t<view class=\"AppLayout\" :class=\"layoutClass\">\n\t\t<!-- 顶部安全区占位 + 导航（移动端显示） -->\n\t\t<uni-nav-bar :title=\"navTitle.title\" v-if=\"!isDesktop\" statusBar fixed :placeholder=\"true\" :border=\"false\"\n\t\t\t:shadow=\"false\" height=\"42\" :backgroundColor=\"'#ffffff'\" :left-icon=\"showBack ? 'left' : ''\"\n\t\t\t@clickLeft=\"goBackSafely\" style=\"font-weight: bold;\" />\n\t\t<view v-if=\"isDesktop\" class=\"AppLayout__sider\">\n\t\t\t<NavSider :items=\"navItemsPc\" :current=\"activePath\" @navigate=\"handleNavigate\" />\n\t\t</view>\n\n\t\t<view class=\"AppLayout__main\">\n\t\t\t<!-- #ifdef H5 -->\n\t\t\t<!-- H5 端外层是否滚动由 contentScroll 控制，避免双滚动容器 -->\n\t\t\t<view class=\"AppLayout__content\" :class=\"{ 'AppLayout__content--no-scroll': !contentScroll }\">\n\t\t\t\t<slot />\n\t\t\t</view>\n\t\t\t<!-- #endif -->\n\n\t\t\t<!-- #ifndef H5 -->\n\t\t\t<!-- App/小程序默认外层滚动；如页面需自管滚动，可通过 props 关闭 -->\n\t\t\t<template v-if=\"contentScroll\">\n\t\t\t\t<scroll-view class=\"AppLayout__content\" :scroll-y=\"true\" enable-flex>\n\t\t\t\t\t<slot />\n\t\t\t\t</scroll-view>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<view class=\"AppLayout__content\">\n\t\t\t\t\t<slot />\n\t\t\t\t</view>\n\t\t\t</template>\n\t\t\t<!-- #endif -->\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\n\timport {\n\t\tcomputed,\n\t\tref,\n\t\twatch\n\t} from 'vue'\n\timport NavSider from './NavSider.vue'\n\timport {\n\t\tusePlatformInfo\n\t} from '@/utils/platform'\n\timport {\n\t\tuseSafeArea\n\t} from '@/utils/safe-area'\n\timport {\n\t\tnavTitleStore\n\t} from '@/stores/navTitle.js'\n\tconst navTitle = navTitleStore()\n\n\t// 组件入参\n\tconst props = defineProps({\n\t\tcurrent: {\n\t\t\ttype: String,\n\t\t\trequired: true\n\t\t},\n\t\t// 非 H5 生效：是否由 AppLayout 外层承担滚动\n\t\tcontentScroll: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t})\n\n\tconst emit = defineEmits(['navigate'])\n\tconst {\n\t\tisDesktop\n\t} = usePlatformInfo()\n\tconst activePath = ref(props.current)\n\tconst {\n\t\ttotalNavHeightPx\n\t} = useSafeArea()\n\n\twatch(() => props.current, (value) => {\n\t\tactivePath.value = value\n\t})\n\n\tconst layoutClass = computed(() => (isDesktop.value ? 'AppLayout--desktop' : 'AppLayout--mobile'))\n\n\t// 顶部占位样式（避免 fixed 导航遮挡内容）\n\tconst topSpacerStyle = computed(() => `height:${(totalNavHeightPx || { value: 64 }).value}px;`)\n\n\t// ====== 返回按钮判定与行为（仅优化返回功能，其他逻辑不改动）======\n\t// 中文注释：为避免影响现有功能，仅在移动端（!isDesktop）且非 Tab 页时显示返回图标\n\t// 规范化当前路径，确保以 / 开头，便于与 Tab 集合对比\n\tconst currentUrl = computed(() => {\n\t\tconst p = String(activePath.value || '').trim()\n\t\treturn p.startsWith('/') ? p : '/' + p\n\t})\n\n\t// Tab 页集合：用于判断是否显示返回按钮（这些页面不显示返回）\n\tconst TAB_PAGES = new Set([\n\t\t'/pages/home/index',\n\t\t'/pages/knowledge/index',\n\t\t'/pages/profile/index',\n\t])\n\n\t// 是否显示返回按钮（仅在移动端且非 Tab 页）\n\tconst showBack = computed(() => !isDesktop.value && !TAB_PAGES.has(currentUrl.value))\n\n\t// 安全返回：优先使用历史返回；无历史栈时按分类兜底\n\tfunction goBackSafely() {\n\t\t// 优先返回上一级（存在历史栈）\n\t\ttry {\n\t\t\tconst pages = typeof getCurrentPages === 'function' ? getCurrentPages() : []\n\t\t\tif (Array.isArray(pages) && pages.length > 1) {\n\t\t\t\tuni.navigateBack()\n\t\t\t\treturn\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// 忽略异常，继续兜底逻辑\n\t\t}\n\n\t\t// 兜底：个人中心子页 → 我的 Tab；其他子页 → 首页 Tab\n\t\tconst url = currentUrl.value\n\t\tif (url.startsWith('/pages/profile/') && url !== '/pages/profile/index') {\n\t\t\ttry {\n\t\t\t\tuni.switchTab({\n\t\t\t\t\turl: '/pages/profile/index'\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tuni.redirectTo({\n\t\t\t\t\turl: '/pages/profile/index'\n\t\t\t\t})\n\t\t\t}\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tuni.switchTab({\n\t\t\t\t\turl: '/pages/home/index'\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tuni.redirectTo({\n\t\t\t\t\turl: '/pages/home/index'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t// 桌面侧栏导航项（新增首页；其余功能保留为快捷入口）\n\tconst navItemsPc = [{\n\t\t\tpath: 'pages/home/index',\n\t\t\tlabel: '首页',\n\t\t\ticon: 'home'\n\t\t},\n\t\t{\n\t\t\tpath: 'pages/chat/index',\n\t\t\tlabel: 'AI问答',\n\t\t\ticon: 'chat'\n\t\t},\n\t\t{\n\t\t\tpath: 'pages/doc-generator/index',\n\t\t\tlabel: '报告生成',\n\t\t\ticon: 'compose'\n\t\t},\n\t\t{\n\t\t\tpath: 'pages/compliance/index',\n\t\t\tlabel: '报告审查',\n\t\t\ticon: 'calendar'\n\t\t},\n\t\t{\n\t\t\tpath: 'pages/knowledge/index',\n\t\t\tlabel: '知识库',\n\t\t\ticon: 'folder-add'\n\t\t},\n\t\t{\n\t\t\tpath: 'pages/profile/index',\n\t\t\tlabel: '个人中心',\n\t\t\ticon: 'person'\n\t\t},\n\t]\n\n\t// 统一跳转逻辑\n\t// - 目标为 tabBar 页面：使用 switchTab\n\t// - 其它页面：使用 redirectTo（可按需替换 navigateTo/reLaunch）\n\tfunction handleNavigate(item) {\n\t\tif (!item?.path || item.path === activePath.value) return\n\t\temit('navigate', item.path)\n\t\tconst url = item.path.startsWith('/') ? item.path : `/${item.path}`\n\t\tconst tabPages = new Set([\n\t\t\t'/pages/home/index',\n\t\t\t'/pages/knowledge/index',\n\t\t\t'/pages/profile/index',\n\t\t])\n\n\t\tif (tabPages.has(url)) {\n\t\t\ttry {\n\t\t\t\tuni.switchTab({\n\t\t\t\t\turl\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tuni.redirectTo({\n\t\t\t\t\turl\n\t\t\t\t})\n\t\t\t}\n\t\t} else {\n\t\t\tuni.redirectTo({\n\t\t\t\turl\n\t\t\t})\n\t\t}\n\t}\n\n\t// 根据屏幕宽度控制官方 tabBar 显隐\n\t// - 桌面端（>=1024）隐藏底部 tabBar，仅显示左侧侧栏\n\t// - 移动端显示底部 tabBar\n\twatch(() => isDesktop.value, (val) => {\n\t\ttry {\n\t\t\tif (val) uni.hideTabBar()\n\t\t\telse uni.showTabBar()\n\t\t} catch (e) {}\n\t}, {\n\t\timmediate: true\n\t})\n</script>\n\n<style lang=\"scss\" scoped>\n\t.AppLayout {\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t\tbackground-color: #f5f7fa;\n\t\tcolor: #1f2329;\n\t}\n\n\t.AppLayout__sider {\n\t\twidth: 350rpx;\n\t\tmax-width: 320px;\n\t\tbackground-color: #ffffff;\n\t\tborder-right: 1px solid rgba(0, 0, 0, 0.08);\n\t\tbox-shadow: 4rpx 0 12rpx rgba(15, 23, 42, 0.04);\n\t}\n\n\t.AppLayout__main {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tbackground-color: #f5f7fa;\n\t\theight: 100%;\n\t\tmin-height: 0;\n\t\toverflow: hidden;\n\t}\n\n\t.AppLayout__content {\n\t\tflex: 1;\n\t\tpadding: 24rpx;\n\t\tbox-sizing: border-box;\n\t\theight: 100%;\n\t\tmin-height: 0;\n\t\toverflow: auto;\n\t}\n\n\t/* 当页面声明由自身管理滚动（如聊天页），H5 端需关闭外层滚动 */\n\t.AppLayout__content--no-scroll {\n\t\toverflow: hidden;\n\t}\n\n\t.AppLayout--mobile {\n\t\tflex-direction: column;\n\t}\n\n\t/* #ifdef H5 */\n\t/* H5 高度策略：优先使用 100dvh，兼容 iOS Safari 地址栏收缩；提供 100vh 回退 */\n\t.AppLayout {\n\t\theight: 100dvh;\n\t\theight: 100vh;\n\t\toverflow: hidden;\n\t}\n\n\t/* #endif */\n\n\t/* #ifdef MP-WEIXIN */\n\t/* 让小程序根节点有参照高度，百分比高度才能生效 */\n\tpage {\n\t\theight: 100%;\n\t}\n\n\t.AppLayout {\n\t\theight: 100dvh;\n\t\theight: 100vh;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t/* #endif */\n</style>","import Component from 'C:/Users/97247/Desktop/uni-ecoful/components/layout/AppLayout.vue'\nwx.createComponent(Component)"],"names":["navTitleStore","usePlatformInfo","ref","useSafeArea","watch","computed","uni"],"mappings":"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"}