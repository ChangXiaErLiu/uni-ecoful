{"version":3,"file":"project.js","sources":["api/project.js"],"sourcesContent":["/**\r\n * 项目管理接口方法\r\n * author:zyg\r\n * date:2025.12.1\r\n */\r\nimport {\r\n\trequest\r\n} from '@/utils/request.js'\r\n/* ================== 1. 项目基础 ================== */\r\n/**\r\n * 创建项目\r\n * @param {Object} data\r\n * @param {string} data.name          项目名称（必填）\r\n * @param {string} data.description   项目背景（可选）\r\n * @param {string} data.notes         备注（可选）\r\n * @param {number[]} data.member_ids  项目成员用户 ID 数组（可选）\r\n * @returns {Promise}\r\n */\r\nexport function createProjects(data) {\r\n\treturn request.post('/api/v1/project/projects', data)\r\n}\r\n\r\n/**\r\n * 获取项目列表\r\n * @returns {Promise<Array>} 返回项目列表数组\r\n */\r\nexport function getProjects() {\r\n\treturn request.get('/api/v1/project/projects')\r\n}\r\n\r\n/**\r\n * 获取项目详情\r\n * @param {number} projectId 项目ID\r\n * @returns {Promise<Object>} 返回项目详情对象\r\n */\r\nexport function getProjectDetail(projectId) {\r\n\treturn request.get(`/api/v1/project/projects/${projectId}`)\r\n}\r\n\r\n/**\r\n * 更新项目\r\n * @param {number} projectId 项目ID\r\n * @param {Object} data 更新数据\r\n * @param {string} data.name          项目名称（可选）\r\n * @param {string} data.description   项目背景（可选）\r\n * @param {string} data.notes         备注（可选）\r\n * @param {number[]} data.member_ids  项目成员用户 ID 数组（可选，覆盖模式）\r\n * @returns {Promise<Object>} 返回更新后的项目信息\r\n */\r\nexport function updateProject(projectId, data) {\r\n\treturn request.patch(`/api/v1/project/projects/${projectId}`, data)\r\n}\r\n\r\n/**\r\n * 删除项目\r\n * @param {number} projectId 项目ID\r\n * @returns {Promise<Object>} 返回删除结果\r\n */\r\nexport function deleteProject(projectId) {\r\n\treturn request.delete(`/api/v1/project/projects/${projectId}`)\r\n}\r\n\r\n\r\n/* ================== 2. 成员管理 ================== */\r\n/**\r\n * 获取项目成员列表\r\n * @param {number} projectId 项目ID\r\n * @returns {Promise<Object>} 返回成员列表和总数\r\n */\r\nexport function getProjectMembers(projectId) {\r\n\treturn request.get(`/api/v1/project/projects/${projectId}/members`)\r\n}\r\n\r\n/**\r\n * 添加项目成员\r\n * @param {number} projectId 项目ID\r\n * @param {number} userId 用户ID\r\n * @returns {Promise<Object>} 返回添加结果\r\n */\r\nexport function addProjectMember(projectId, userId) {\r\n\treturn request.post(`/api/v1/project/projects/${projectId}/members`, {\r\n\t\tuser_id: userId\r\n\t})\r\n}\r\n\r\n/**\r\n * 移除项目成员\r\n * @param {number} projectId 项目ID\r\n * @param {number} userId 用户ID\r\n * @returns {Promise<Object>} 返回移除结果\r\n */\r\nexport function removeProjectMember(projectId, userId) {\r\n\treturn request.delete(`/api/v1/project/projects/${projectId}/members/${userId}`)\r\n}\r\n\r\n\r\n/* ================== 3. 文件管理 ================== */\r\n// 因为微信小程序和h5、图片、文件上传处理方法不一样，因此要区分\r\n// 参考地址:https://uniapp.dcloud.net.cn/api/media/file.html#choosefile\r\n\r\n/** 选择文件（H5、App、微信小程序通用）\r\n * 内部自动区分平台，返回统一格式 { path, name, size, type, file? }\r\n * 失败或取消返回 null\r\n */\r\nexport function pickProjectFile() {\r\n\tconst isMp = () => process.env.UNI_PLATFORM === 'mp-weixin'\r\n\tconst isH5 = () => process.env.UNI_PLATFORM === 'h5'\r\n\r\n\t/* 1. H5 必须走“同步回调”方式 */\r\n\tif (isH5()) {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tuni.chooseFile({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\ttype: 'all',\r\n\t\t\t\textension: ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.md', '.txt',\r\n\t\t\t\t\t'.jpg', '.jpeg', '.png'\r\n\t\t\t\t],\r\n\t\t\t\tsuccess: (res) => resolve(wrapFile(res.tempFiles[0])),\r\n\t\t\t\tfail: () => resolve(null)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/* 2. 微信小程序 / App：同步 API */\r\n\tlet res\r\n\ttry {\r\n\t\tif (isMp()) {\r\n\t\t\tres = wx.chooseMessageFile({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\ttype: 'file'\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tres = uni.chooseFile({\r\n\t\t\t\tcount: 1,\r\n\t\t\t\ttype: 'all',\r\n\t\t\t\textension: []\r\n\t\t\t})\r\n\t\t}\r\n\t} catch (e) {\r\n\t\treturn Promise.resolve(null)\r\n\t}\r\n\treturn Promise.resolve(res).then(r => wrapFile(r.tempFiles[0]))\r\n}\r\n\r\n/* 公用包装 */\nfunction wrapFile(raw) {\n  if (!raw) return null\n  const max = 500 * 1024 * 1024\n  if (raw.size > max) {\n    uni.showToast({ title: '文件不能超过 500 MB', icon: 'none' })\n    return null\n  }\n  return {\n    path: raw.path || raw.tempFilePath,\n    name: raw.name || 'unknown',\n    size: raw.size,\n    type: getFileExt(raw.name),\n    file: raw\n  }\n}\r\n\r\n/*** 选择图片（uni.chooseImage 封装）*/\r\nexport function pickProjectImage() {\r\n\tconst isH5 = () => process.env.UNI_PLATFORM === 'h5'\r\n\r\n\t// ⚡️ H5 环境：uni.chooseImage 返回 Promise\r\n\tif (isH5()) {\r\n\t\treturn uni.chooseImage({\r\n\t\t\t\tcount: 1\r\n\t\t\t})\r\n\t\t\t.then(res => (res.tempFiles || [])[0])\r\n\t\t\t.then(raw => {\r\n\t\t\t\tif (!raw) return null\r\n\r\n\t\t\t\tconst max = 100 * 1024 * 1024\r\n\t\t\t\tif (raw.size > max) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '图片不能超过 100 MB',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn null\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tpath: raw.path || raw.tempFilePath,\r\n\t\t\t\t\tname: raw.name || 'image.jpg',\r\n\t\t\t\t\tsize: raw.size,\r\n\t\t\t\t\ttype: getFileExt(raw.name),\r\n\t\t\t\t\tfile: raw\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(() => null)\r\n\t}\r\n\r\n\t// 微信小程序/App：同步 API\r\n\tlet res\r\n\ttry {\r\n\t\tres = uni.chooseImage({\r\n\t\t\tcount: 1\r\n\t\t})\r\n\t} catch (e) {\r\n\t\treturn Promise.resolve(null)\r\n\t}\r\n\r\n\treturn Promise.resolve(res)\r\n\t\t.then(res => (res.tempFiles || [])[0])\r\n\t\t.then(raw => {\r\n\t\t\tif (!raw) return null\r\n\r\n\t\t\tconst max = 100 * 1024 * 1024\r\n\t\t\tif (raw.size > max) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '图片不能超过 100 MB',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn null\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tpath: raw.path || raw.tempFilePath,\r\n\t\t\t\tname: raw.name || 'image.jpg',\r\n\t\t\t\tsize: raw.size,\r\n\t\t\t\ttype: getFileExt(raw.name),\r\n\t\t\t\tfile: raw\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => null)\r\n}\r\n\r\n// 辅助函数\r\nfunction getFileExt(filename) {\r\n\tif (!filename) return ''\r\n\tconst parts = filename.split('.')\r\n\treturn parts.length > 1 ? parts.pop().toLowerCase() : ''\r\n}\r\n\r\n/**\r\n * 真正上传（内部自动区分平台）\r\n * @param {Number} projectId\r\n * @param {Object} fileInfo 上面两个函数返回的对象\r\n * @returns {Promise<Object>} 后端返回的文档信息\r\n */\r\nexport async function uploadProjectFile(projectId, fileInfo) {\r\n\tif (!fileInfo) throw new Error('未选择文件')\r\n\r\n\tconst isMp = () => process.env.UNI_PLATFORM === 'mp-weixin'\r\n\r\n\t// 小程序走 uploadFile\r\n\tif (isMp()) {\r\n\t\treturn request.upload(\r\n\t\t\t`/api/v1/project/projects/${projectId}/documents/upload`,\r\n\t\t\tfileInfo.path, {\r\n\t\t\t\tname: 'file',\r\n\t\t\t\tformData: {\r\n\t\t\t\t\tfilename: fileInfo.name\r\n\t\t\t\t},\r\n\t\t\t\thideLoading: true\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\t// H5 / App 走 axios FormData\r\n\tconst fd = new FormData()\r\n\tfd.append('file', fileInfo.file)\r\n\treturn request.post(\r\n\t\t`/api/v1/project/projects/${projectId}/documents/upload`,\r\n\t\tfd, {\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'multipart/form-data'\r\n\t\t\t}\r\n\t\t}\r\n\t)\r\n}\r\n\r\n/**\r\n * 获取项目文件列表\r\n * @param {number} projectId 项目ID\r\n * @param {Object} params 查询参数（可选）\r\n * @param {number} params.page 页码\r\n * @param {number} params.size 每页数量\r\n * @returns {Promise<Object>} 返回文件列表和总数\r\n */\r\nexport function getProjectDocuments(projectId, params = {}) {\r\n\treturn request.get(`/api/v1/project/projects/${projectId}/documents`, {\r\n\t\tparams\r\n\t})\r\n}\r\n\r\n/**\r\n * 下载项目文件\r\n * @param {number} projectId 项目ID\r\n * @param {string} documentId 文件ID\r\n * @param {string} responseType 响应类型\r\n * @returns {Promise<Blob>} 返回文件流\r\n */\r\nexport async function downloadProjectFile(projectId, documentId) {\r\n\treturn request.get(\r\n\t\t`/api/v1/project/projects/${projectId}/documents/${documentId}/download`, {\r\n\t\t\tresponseType: 'blob'\r\n\t\t}\r\n\t)\r\n}\r\n\r\n/**\r\n * 删除项目文件\r\n * @param {number} projectId 项目ID\r\n * @param {string} documentId 文件ID\r\n * @returns {Promise<Object>} 返回删除结果\r\n */\r\nexport async function removeProjectFile(projectId, documentId) {\r\n\treturn request.delete(\r\n\t\t`/api/v1/project/projects/${projectId}/documents/${documentId}`\r\n\t)\r\n}"],"names":["request","wx","uni","res"],"mappings":"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"}