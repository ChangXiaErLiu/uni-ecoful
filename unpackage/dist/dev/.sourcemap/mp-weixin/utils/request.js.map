{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["/**\r\n * 封装uni.request\r\n * author:zyg\r\n * date:2025.12.1\r\n */\r\nimport {\r\n\tBASE_URL\r\n} from './config.js'\r\n\r\n/**\r\n * 请求拦截器类\r\n * 统一处理：token、loading、错误提示、超时\r\n * 包含了普通的http请求和WebSocket请求\r\n */\r\nclass Request {\r\n\tconstructor(options = {}) {\r\n\t\tthis.baseOptions = options\r\n\t\t// 请求队列（用于控制 loading）\r\n\t\tthis.requestQueue = []\r\n\t}\r\n\r\n\t/**\r\n\t * 核心请求方法\r\n\t * @param {Object} config - 请求配置\r\n\t * @returns {Promise}\r\n\t */\r\n\tasync request(config) {\r\n\t\tconst {\r\n\t\t\turl,\r\n\t\t\tmethod = 'GET',\r\n\t\t\tdata = {},\r\n\t\t\theader = {},\r\n\t\t\thideLoading = false,\r\n\t\t\ttimeout = 30000,\r\n\t\t\tshowError = true\r\n\t\t} = config\r\n\r\n\t\tconst token = uni.getStorageSync('token')\r\n\t\tif (token) header.Authorization = `Bearer ${token}`\r\n\r\n\t\t// 只在不隐藏 loading 时才显示并加入队列\r\n\t\tlet requestId = null\r\n\t\tif (!hideLoading) {\r\n\t\t\trequestId = Date.now()\r\n\t\t\tthis.requestQueue.push(requestId)\r\n\t\t\tthis.showLoading()\r\n\t\t}\r\n\r\n\t\t// ✅ 关键：手动封装 Promise，避免 H5 平台混用\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuni.request({\r\n\t\t\t\turl: url.startsWith('http') ? url : (BASE_URL + url),\r\n\t\t\t\tmethod,\r\n\t\t\t\tdata,\r\n\t\t\t\theader: {\r\n\t\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t\t...this.baseOptions.header,\r\n\t\t\t\t\t...header\r\n\t\t\t\t},\r\n\t\t\t\ttimeout,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (requestId !== null) {\r\n\t\t\t\t\t\tthis.hideLoading(requestId)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 二进制流直接放行,试过了不一定行\r\n\t\t\t\t\tif (config.responseType === 'arraybuffer') {\r\n\t\t\t\t\t\tconsole.log('二进制直通', res.data.byteLength);\r\n\t\t\t\t\t\treturn resolve(res) // 整包返回（含 statusCode、data）\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!res) {\r\n\t\t\t\t\t\treject(new Error('响应为空'))\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 普通 JSON\r\n\t\t\t\t\tif (res.statusCode >= 200 && res.statusCode < 300) {\r\n\t\t\t\t\t\tresolve(res.data)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst error = {\r\n\t\t\t\t\t\t\tcode: res.statusCode,\r\n\t\t\t\t\t\t\tmessage: res.data?.detail || '请求失败',\r\n\t\t\t\t\t\t\tdata: res.data\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (showError) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: String(error.message ?? error.data?.detail ?? '请求失败'), // 强制字符串\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treject(error)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: (error) => {\r\n\t\t\t\t\tif (requestId !== null) {\r\n\t\t\t\t\t\tthis.hideLoading(requestId)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst netError = {\r\n\t\t\t\t\t\tcode: 'NETWORK_ERROR',\r\n\t\t\t\t\t\tmessage: error.errMsg || '网络请求失败',\r\n\t\t\t\t\t\toriginalError: error\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (showError) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: netError.message,\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\treject(netError)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * 显示 loading\r\n\t */\r\n\tshowLoading() {\r\n\t\tif (this.requestQueue.length === 1) { // 第一个请求才显示\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '加载中...',\r\n\t\t\t\tmask: true\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 隐藏 loading\r\n\t */\r\n\thideLoading(requestId) {\r\n\t\t// 从队列中移除当前请求\r\n\t\tconst index = this.requestQueue.indexOf(requestId)\r\n\t\tif (index > -1) {\r\n\t\t\tthis.requestQueue.splice(index, 1)\r\n\t\t}\r\n\r\n\t\t// 队列为空时隐藏 loading\r\n\t\tif (this.requestQueue.length === 0) {\r\n\t\t\tuni.hideLoading()\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * 流式请求（用于 AI 聊天、大文本生成等场景）\r\n\t * @param {Object} config - 请求配置 { url, method, body }\r\n\t * @param {Function} onDelta - 收到数据片段的回调\r\n\t * @param {Function} onError - 错误回调\r\n\t * @param {Function} onDone - 完成回调\r\n\t * @returns {Function} cancel - 取消请求的函数\r\n\t */\r\n\tchatStream(config, onDelta, onError, onDone) {\r\n\t\tconst {\r\n\t\t\turl,\r\n\t\t\tmethod = 'POST',\r\n\t\t\tbody = {}\r\n\t\t} = config\r\n\r\n\t\t// 1. 构建完整 URL（使用 WS_URL 基础地址）\r\n\t\tconst fullUrl = (url.startsWith('ws') || url.startsWith('http')) ?\r\n\t\t\turl.replace(/^https?/, 'ws') // 自动转换 http/https 为 ws/wss\r\n\t\t\t:\r\n\t\t\tWS_URL + url // 使用相对路径\r\n\r\n\t\t// 2. 建立 WebSocket 连接\r\n\t\tconst socket = uni.connectSocket({\r\n\t\t\turl: fullUrl,\r\n\t\t\tmethod,\r\n\t\t\theader: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t// 传递 token（如果需要）\r\n\t\t\t\t...(uni.getStorageSync('token') ? {\r\n\t\t\t\t\tAuthorization: `Bearer ${uni.getStorageSync('token')}`\r\n\t\t\t\t} : {}),\r\n\t\t\t\t...this.baseOptions.header\r\n\t\t\t},\r\n\t\t\tsuccess: () => {\r\n\t\t\t\tconsole.log('[WebSocket] 连接成功:', fullUrl)\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.error('[WebSocket] 连接失败:', err)\r\n\t\t\t\tonError?.(new Error('WebSocket 连接失败: ' + err.errMsg))\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// 3. 监听消息接收\r\n\t\tsocket.onMessage((res) => {\r\n\t\t\ttry {\r\n\t\t\t\t// 假设后端返回格式：{ type: 'delta', data: '...' } 或 { type: 'error', message: '...' }\r\n\t\t\t\tconst message = JSON.parse(res.data)\r\n\r\n\t\t\t\tswitch (message.type) {\r\n\t\t\t\t\tcase 'delta':\r\n\t\t\t\t\t\tonDelta?.(message.data)\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase 'error':\r\n\t\t\t\t\t\tonError?.(new Error(message.message || 'Stream error'))\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tcase 'done':\r\n\t\t\t\t\t\tonDone?.()\r\n\t\t\t\t\t\tsocket.close()\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// 兼容纯文本格式\r\n\t\t\t\t\t\tif (typeof res.data === 'string') {\r\n\t\t\t\t\t\t\tonDelta?.(res.data)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// 解析失败，按纯文本处理\r\n\t\t\t\tonDelta?.(res.data)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// 4. 监听错误\r\n\t\tsocket.onError((err) => {\r\n\t\t\tconsole.error('[WebSocket] 错误:', err)\r\n\t\t\tonError?.(new Error('WebSocket 错误: ' + err.errMsg))\r\n\t\t})\r\n\r\n\t\t// 5. 监听连接关闭\r\n\t\tsocket.onClose((res) => {\r\n\t\t\tconsole.log('[WebSocket] 连接关闭:', res.code, res.reason)\r\n\t\t\tif (res.code !== 1000) { // 1000 是正常关闭\r\n\t\t\t\tonError?.(new Error('连接异常关闭: ' + res.reason))\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// 6. 连接打开后发送请求体\r\n\t\tsocket.onOpen(() => {\r\n\t\t\tsocket.send({\r\n\t\t\t\tdata: JSON.stringify(body)\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t// 7. 返回取消函数\r\n\t\tconst cancel = () => {\r\n\t\t\tconsole.log('[WebSocket] 主动取消请求')\r\n\t\t\tsocket.close()\r\n\t\t}\r\n\r\n\t\treturn cancel\r\n\t}\r\n\r\n\r\n\t// 快捷请求方法\r\n\tget(url, config = {}) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'GET'\r\n\t\t})\r\n\t}\r\n\r\n\tpost(url, data = {}, config = {}) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata\r\n\t\t})\r\n\t}\r\n\r\n\tput(url, data = {}, config = {}) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tdata\r\n\t\t})\r\n\t}\r\n\r\n\tdelete(url, config = {}) {\r\n\t\treturn this.request({\r\n\t\t\t...config,\r\n\t\t\turl,\r\n\t\t\tmethod: 'DELETE'\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * 文件上传方法\r\n\t * @param {String} url - 上传接口地址\r\n\t * @param {String} filePath - 文件路径\r\n\t * @param {Object} options - 配置项\r\n\t * @param {String} options.name - 文件对应的 key，默认 'file'\r\n\t * @param {Object} options.formData - 额外的表单数据\r\n\t * @param {Object} options.header - 额外的请求头\r\n\t * @param {Boolean} options.hideLoading - 是否隐藏 loading\r\n\t * @returns {Promise}\r\n\t */\r\n\tupload(url, filePath, options = {}) {\r\n\t\tconst {\r\n\t\t\tname = 'file',\r\n\t\t\tformData = {},\r\n\t\t\theader = {},\r\n\t\t\thideLoading = false\r\n\t\t} = options\r\n\r\n\t\tconst token = uni.getStorageSync('token')\r\n\t\tconst uploadHeader = {\r\n\t\t\t...this.baseOptions.header,\r\n\t\t\t...header\r\n\t\t}\r\n\t\tif (token) {\r\n\t\t\tuploadHeader.Authorization = `Bearer ${token}`\r\n\t\t}\r\n\r\n\t\t// 显示 loading\r\n\t\tlet requestId = null\r\n\t\tif (!hideLoading) {\r\n\t\t\trequestId = Date.now()\r\n\t\t\tthis.requestQueue.push(requestId)\r\n\t\t\tthis.showLoading()\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuni.uploadFile({\r\n\t\t\t\turl: url.startsWith('http') ? url : (BASE_URL + url),\r\n\t\t\t\tfilePath,\r\n\t\t\t\tname,\r\n\t\t\t\tformData,\r\n\t\t\t\theader: uploadHeader,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (requestId !== null) {\r\n\t\t\t\t\t\tthis.hideLoading(requestId)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// 解析响应数据\r\n\t\t\t\t\t\tconst data = typeof res.data === 'string' ? JSON.parse(res.data) : res.data\r\n\r\n\t\t\t\t\t\tif (res.statusCode >= 200 && res.statusCode < 300) {\r\n\t\t\t\t\t\t\tresolve(data)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst error = {\r\n\t\t\t\t\t\t\t\tcode: res.statusCode,\r\n\t\t\t\t\t\t\t\tmessage: data?.detail || '上传失败',\r\n\t\t\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: error.message,\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\treject(error)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconst parseError = {\r\n\t\t\t\t\t\t\tcode: 'PARSE_ERROR',\r\n\t\t\t\t\t\t\tmessage: '解析响应失败',\r\n\t\t\t\t\t\t\toriginalError: e\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: parseError.message,\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treject(parseError)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: (error) => {\r\n\t\t\t\t\tif (requestId !== null) {\r\n\t\t\t\t\t\tthis.hideLoading(requestId)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst netError = {\r\n\t\t\t\t\t\tcode: 'UPLOAD_ERROR',\r\n\t\t\t\t\t\tmessage: error.errMsg || '上传失败',\r\n\t\t\t\t\t\toriginalError: error\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: netError.message,\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\treject(netError)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// 导出单例\r\nexport const request = new Request()"],"names":["uni","BASE_URL"],"mappings":"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"}