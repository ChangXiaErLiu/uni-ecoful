{"version":3,"file":"change-password.js","sources":["pages/profile/change-password.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9jaGFuZ2UtcGFzc3dvcmQudnVl"],"sourcesContent":["<!-- 修改登录密码页面（UTF-8，中文注释） -->\n<template>\n  <app-layout current=\"pages/profile/change-password\">\n    <view class=\"profile-page\">\n      <view class=\"profile__card\">\n        <view class=\"profile__card-header\">\n          <uni-icons type=\"locked-filled\" size=\"20\" color=\"#276019\" />\n          <text class=\"profile__card-title\">修改登录密码</text>\n        </view>\n        <view class=\"profile__card-content\">\n          <uni-forms :modelValue=\"form\" :rules=\"rules\" ref=\"formRef\">\n            <view class=\"form-row\">\n              <text class=\"form-label\">旧密码</text>\n              <uni-easyinput v-model=\"form.oldPwd\" type=\"password\" placeholder=\"请输入旧密码\" :clearable=\"true\" />\n            </view>\n            <view class=\"form-row\">\n              <text class=\"form-label\">新密码</text>\n              <uni-easyinput v-model=\"form.newPwd\" type=\"password\" placeholder=\"至少8位，含字母和数字\" />\n              <view class=\"hint-row\">\n                <text class=\"form-hint\">强度：{{ strengthText }}</text>\n              </view>\n            </view>\n            <view class=\"form-row\">\n              <text class=\"form-label\">确认新密码</text>\n              <uni-easyinput v-model=\"form.confirmPwd\" type=\"password\" placeholder=\"请再次输入新密码\" />\n            </view>\n          </uni-forms>\n        </view>\n      </view>\n\n      <view class=\"actions\">\n        <button class=\"profile__submit-btn\" :disabled=\"submitting\" @tap=\"handleSubmit\">{{ submitting ? '提交中...' : '确认修改' }}</button>\n      </view>\n\n      <view class=\"safe-area-bottom\" />\n    </view>\n  </app-layout>\n</template>\n\n<script setup>\n// UTF-8，中文注释\nimport { ref, computed } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport AppLayout from '@/components/layout/AppLayout.vue'\nimport { navTitleStore } from '@/stores/navTitle.js'\nimport { request } from '@/utils/request.js'\n\nconst navTitle = navTitleStore()\nonShow(() => navTitle.setTitle('修改密码'))\n\nconst formRef = ref(null)\nconst form = ref({ oldPwd: '', newPwd: '', confirmPwd: '' })\nconst submitting = ref(false)\n\n// 简易强度评估\nconst strengthText = computed(() => {\n  const p = form.value.newPwd || ''\n  let score = 0\n  if (p.length >= 8) score++\n  if (/[A-Z]/.test(p)) score++\n  if (/[a-z]/.test(p)) score++\n  if (/\\d/.test(p)) score++\n  if (/[^A-Za-z0-9]/.test(p)) score++\n  return ['很弱','较弱','一般','较强','很强'][Math.max(0, Math.min(score-1, 4))]\n})\n\nconst rules = {\n  oldPwd: { required: true, errorMessage: '请输入旧密码' },\n  newPwd: {\n    required: true,\n    errorMessage: '请输入新密码',\n    validateFunction: (rule, value, data, callback) => {\n      const v = String(value || '')\n      if (v.length < 8) return callback('至少8位')\n      if (!/[A-Za-z]/.test(v) || !/\\d/.test(v)) return callback('需包含字母和数字')\n      return callback()\n    }\n  },\n  confirmPwd: {\n    required: true,\n    errorMessage: '请确认新密码',\n    validateFunction: (rule, value, data, callback) => {\n      if (String(value || '') !== String(form.value.newPwd || '')) return callback('两次输入不一致')\n      return callback()\n    }\n  }\n}\n\nasync function handleSubmit() {\n  try {\n    await formRef.value?.validate?.()\n  } catch (e) {\n    return\n  }\n  submitting.value = true\n  try {\n    await request({ url: '/user/password/change', method: 'POST', data: { oldPwd: form.value.oldPwd, newPwd: form.value.newPwd } })\n    // 是否同时下线其他设备\n    uni.showModal({\n      title: '修改成功',\n      content: '是否同时下线其他设备？',\n      success: async (res) => {\n        if (res.confirm) {\n          try { await request({ url: '/user/sessions/logout-others', method: 'POST', data: {} }) } catch (e) {}\n        }\n        uni.showToast({ title: '密码已修改', icon: 'success' })\n        setTimeout(() => uni.navigateBack({ delta: 1 }), 600)\n      }\n    })\n  } catch (e) {\n    uni.showToast({ title: '修改失败，请稍后重试', icon: 'none' })\n  } finally {\n    submitting.value = false\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.profile-page { display: flex; flex-direction: column; gap: 24rpx; background-color: #f5f7fa; }\n.profile__card { background-color: #ffffff; border-radius: 20rpx; overflow: hidden; }\n.profile__card-header { display: flex; align-items: center; gap: 16rpx; padding: 32rpx 32rpx 24rpx; border-bottom: 1rpx solid #f1f5f9; }\n.profile__card-title { font-size: 30rpx; font-weight: 600; color: #0f172a; }\n.profile__card-content { padding: 0; }\n.form-row { display: flex; flex-direction: column; gap: 16rpx; padding: 24rpx 32rpx; }\n.form-label { font-size: 28rpx; color: #334155; }\n.hint-row { padding: 0 32rpx 16rpx; }\n.form-hint { font-size: 26rpx; color: #94a3b8; }\n.actions { padding: 0 24rpx; }\n.profile__submit-btn { width: 100%; background: #276019; color: #fff; border: none; border-radius: 16rpx; padding: 24rpx; font-size: 32rpx; font-weight: 600; }\n.profile__submit-btn:active { opacity: .9; transform: scale(.98); }\n.safe-area-bottom { height: env(safe-area-inset-bottom); min-height: 0rpx; }\n</style>\n\n","import MiniProgramPage from 'C:/Users/97247/Desktop/uni-ecoful/pages/profile/change-password.vue'\nwx.createPage(MiniProgramPage)"],"names":["navTitleStore","onShow","ref","computed","request","uni"],"mappings":";;;;;;;;;;;;;;;;AA2CA,MAAM,YAAY,MAAW;;;;AAI7B,UAAM,WAAWA,gBAAAA,cAAe;AAChCC,kBAAM,OAAC,MAAM,SAAS,SAAS,MAAM,CAAC;AAEtC,UAAM,UAAUC,cAAG,IAAC,IAAI;AACxB,UAAM,OAAOA,cAAAA,IAAI,EAAE,QAAQ,IAAI,QAAQ,IAAI,YAAY,IAAI;AAC3D,UAAM,aAAaA,cAAG,IAAC,KAAK;AAG5B,UAAM,eAAeC,cAAQ,SAAC,MAAM;AAClC,YAAM,IAAI,KAAK,MAAM,UAAU;AAC/B,UAAI,QAAQ;AACZ,UAAI,EAAE,UAAU;AAAG;AACnB,UAAI,QAAQ,KAAK,CAAC;AAAG;AACrB,UAAI,QAAQ,KAAK,CAAC;AAAG;AACrB,UAAI,KAAK,KAAK,CAAC;AAAG;AAClB,UAAI,eAAe,KAAK,CAAC;AAAG;AAC5B,aAAO,CAAC,MAAK,MAAK,MAAK,MAAK,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,IAAI,QAAM,GAAG,CAAC,CAAC,CAAC;AAAA,IACrE,CAAC;AAED,UAAM,QAAQ;AAAA,MACZ,QAAQ,EAAE,UAAU,MAAM,cAAc,SAAU;AAAA,MAClD,QAAQ;AAAA,QACN,UAAU;AAAA,QACV,cAAc;AAAA,QACd,kBAAkB,CAAC,MAAM,OAAO,MAAM,aAAa;AACjD,gBAAM,IAAI,OAAO,SAAS,EAAE;AAC5B,cAAI,EAAE,SAAS;AAAG,mBAAO,SAAS,MAAM;AACxC,cAAI,CAAC,WAAW,KAAK,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC;AAAG,mBAAO,SAAS,UAAU;AACpE,iBAAO,SAAU;AAAA,QAClB;AAAA,MACF;AAAA,MACD,YAAY;AAAA,QACV,UAAU;AAAA,QACV,cAAc;AAAA,QACd,kBAAkB,CAAC,MAAM,OAAO,MAAM,aAAa;AACjD,cAAI,OAAO,SAAS,EAAE,MAAM,OAAO,KAAK,MAAM,UAAU,EAAE;AAAG,mBAAO,SAAS,SAAS;AACtF,iBAAO,SAAU;AAAA,QAClB;AAAA,MACF;AAAA,IACH;AAEA,mBAAe,eAAe;;AAC5B,UAAI;AACF,gBAAM,mBAAQ,UAAR,mBAAe,aAAf;AAAA,MACP,SAAQ,GAAG;AACV;AAAA,MACD;AACD,iBAAW,QAAQ;AACnB,UAAI;AACF,cAAMC,cAAAA,QAAQ,EAAE,KAAK,yBAAyB,QAAQ,QAAQ,MAAM,EAAE,QAAQ,KAAK,MAAM,QAAQ,QAAQ,KAAK,MAAM,OAAM,GAAI;AAE9HC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS;AAAA,UACT,SAAS,OAAO,QAAQ;AACtB,gBAAI,IAAI,SAAS;AACf,kBAAI;AAAE,sBAAMD,cAAO,QAAC,EAAE,KAAK,gCAAgC,QAAQ,QAAQ,MAAM,CAAA,EAAI,CAAA;AAAA,uBAAW,GAAG;AAAA,cAAE;AAAA,YACtG;AACDC,0BAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,WAAW;AACjD,uBAAW,MAAMA,cAAAA,MAAI,aAAa,EAAE,OAAO,EAAC,CAAE,GAAG,GAAG;AAAA,UACrD;AAAA,QACP,CAAK;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,MACvD,UAAY;AACR,mBAAW,QAAQ;AAAA,MACpB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjHA,GAAG,WAAW,eAAe;"}