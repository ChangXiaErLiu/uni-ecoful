{"version":3,"file":"changePassword.js","sources":["pages/profile/changePassword.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9jaGFuZ2VQYXNzd29yZC52dWU"],"sourcesContent":["<!-- 修改登录密码页面（UTF-8，中文注释） -->\r\n<template>\r\n  <AppLayout current=\"pages/profile/changePassword\">\r\n    <view class=\"profile-page\">\r\n      <view class=\"profile__card\">\r\n        <view class=\"profile__card-header\">\r\n          <uni-icons type=\"locked-filled\" size=\"20\" color=\"#276019\" />\r\n          <text class=\"profile__card-title\">修改登录密码</text>\r\n        </view>\r\n        <view class=\"profile__card-content\">\r\n          <uni-forms :modelValue=\"form\" :rules=\"rules\" ref=\"formRef\">\r\n            <view class=\"form-row\">\r\n              <text class=\"form-label\">旧密码</text>\r\n              <uni-easyinput v-model=\"form.oldPwd\" type=\"password\" placeholder=\"请输入旧密码\" :clearable=\"true\" />\r\n            </view>\r\n            <view class=\"form-row\">\r\n              <text class=\"form-label\">新密码</text>\r\n              <uni-easyinput v-model=\"form.newPwd\" type=\"password\" placeholder=\"至少8位，含字母和数字\" />\r\n              <view class=\"hint-row\">\r\n                <text class=\"form-hint\">强度：{{ strengthText }}</text>\r\n              </view>\r\n            </view>\r\n            <view class=\"form-row\">\r\n              <text class=\"form-label\">确认新密码</text>\r\n              <uni-easyinput v-model=\"form.confirmPwd\" type=\"password\" placeholder=\"请再次输入新密码\" />\r\n            </view>\r\n          </uni-forms>\r\n        </view>\r\n      </view>\r\n\r\n      <view class=\"actions\">\r\n        <button class=\"profile__submit-btn\" :disabled=\"submitting\" @tap=\"handleSubmit\">{{ submitting ? '提交中...' : '确认修改' }}</button>\r\n      </view>\r\n\r\n      <view class=\"safe-area-bottom\" />\r\n    </view>\r\n  </AppLayout>\r\n</template>\r\n\r\n<script setup>\r\n// UTF-8，中文注释\r\nimport { ref, computed } from 'vue'\r\nimport { onShow } from '@dcloudio/uni-app'\r\nimport AppLayout from '@/components/layout/AppLayout.vue'\r\nimport { navTitleStore } from '@/stores/navTitle.js'\r\nimport { request } from '@/utils/request.js'\r\n\r\nconst navTitle = navTitleStore()\r\nonShow(() => navTitle.setTitle('修改密码'))\r\n\r\nconst formRef = ref(null)\r\nconst form = ref({ oldPwd: '', newPwd: '', confirmPwd: '' })\r\nconst submitting = ref(false)\r\n\r\n// 简易强度评估\r\nconst strengthText = computed(() => {\r\n  const p = form.value.newPwd || ''\r\n  let score = 0\r\n  if (p.length >= 8) score++\r\n  if (/[A-Z]/.test(p)) score++\r\n  if (/[a-z]/.test(p)) score++\r\n  if (/\\d/.test(p)) score++\r\n  if (/[^A-Za-z0-9]/.test(p)) score++\r\n  return ['很弱','较弱','一般','较强','很强'][Math.max(0, Math.min(score-1, 4))]\r\n})\r\n\r\nconst rules = {\r\n  oldPwd: { required: true, errorMessage: '请输入旧密码' },\r\n  newPwd: {\r\n    required: true,\r\n    errorMessage: '请输入新密码',\r\n    validateFunction: (rule, value, data, callback) => {\r\n      const v = String(value || '')\r\n      if (v.length < 8) return callback('至少8位')\r\n      if (!/[A-Za-z]/.test(v) || !/\\d/.test(v)) return callback('需包含字母和数字')\r\n      return callback()\r\n    }\r\n  },\r\n  confirmPwd: {\r\n    required: true,\r\n    errorMessage: '请确认新密码',\r\n    validateFunction: (rule, value, data, callback) => {\r\n      if (String(value || '') !== String(form.value.newPwd || '')) return callback('两次输入不一致')\r\n      return callback()\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleSubmit() {\r\n  try {\r\n    await formRef.value?.validate?.()\r\n  } catch (e) {\r\n    return\r\n  }\r\n  submitting.value = true\r\n  try {\r\n    await request({ url: '/user/password/change', method: 'POST', data: { oldPwd: form.value.oldPwd, newPwd: form.value.newPwd } })\r\n    // 是否同时下线其他设备\r\n    uni.showModal({\r\n      title: '修改成功',\r\n      content: '是否同时下线其他设备？',\r\n      success: async (res) => {\r\n        if (res.confirm) {\r\n          try { await request({ url: '/user/sessions/logout-others', method: 'POST', data: {} }) } catch (e) {}\r\n        }\r\n        uni.showToast({ title: '密码已修改', icon: 'success' })\r\n        setTimeout(() => uni.navigateBack({ delta: 1 }), 600)\r\n      }\r\n    })\r\n  } catch (e) {\r\n    uni.showToast({ title: '修改失败，请稍后重试', icon: 'none' })\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.profile-page { display: flex; flex-direction: column; gap: 24rpx; background-color: #f5f7fa; }\r\n.profile__card { background-color: #ffffff; border-radius: 20rpx; overflow: hidden; }\r\n.profile__card-header { display: flex; align-items: center; gap: 16rpx; padding: 32rpx 32rpx 24rpx; border-bottom: 1rpx solid #f1f5f9; }\r\n.profile__card-title { font-size: 30rpx; font-weight: 600; color: #0f172a; }\r\n.profile__card-content { padding: 0; }\r\n.form-row { display: flex; flex-direction: column; gap: 16rpx; padding: 24rpx 32rpx; }\r\n.form-label { font-size: 28rpx; color: #334155; }\r\n.hint-row { padding: 0 32rpx 16rpx; }\r\n.form-hint { font-size: 26rpx; color: #94a3b8; }\r\n.actions { padding: 0 24rpx; }\r\n.profile__submit-btn { width: 100%; background: #276019; color: #fff; border: none; border-radius: 16rpx; padding: 24rpx; font-size: 32rpx; font-weight: 600; }\r\n.profile__submit-btn:active { opacity: .9; transform: scale(.98); }\r\n.safe-area-bottom { height: env(safe-area-inset-bottom); min-height: 0rpx; }\r\n</style>\r\n\r\n","import MiniProgramPage from 'C:/Users/97247/Desktop/uni-ecoful/pages/profile/changePassword.vue'\nwx.createPage(MiniProgramPage)"],"names":["navTitleStore","onShow","ref","computed","request","uni"],"mappings":";;;;;;;;;;;;;;;;AA2CA,MAAM,YAAY,MAAW;;;;AAI7B,UAAM,WAAWA,gBAAAA,cAAe;AAChCC,kBAAM,OAAC,MAAM,SAAS,SAAS,MAAM,CAAC;AAEtC,UAAM,UAAUC,cAAG,IAAC,IAAI;AACxB,UAAM,OAAOA,cAAAA,IAAI,EAAE,QAAQ,IAAI,QAAQ,IAAI,YAAY,IAAI;AAC3D,UAAM,aAAaA,cAAG,IAAC,KAAK;AAG5B,UAAM,eAAeC,cAAQ,SAAC,MAAM;AAClC,YAAM,IAAI,KAAK,MAAM,UAAU;AAC/B,UAAI,QAAQ;AACZ,UAAI,EAAE,UAAU;AAAG;AACnB,UAAI,QAAQ,KAAK,CAAC;AAAG;AACrB,UAAI,QAAQ,KAAK,CAAC;AAAG;AACrB,UAAI,KAAK,KAAK,CAAC;AAAG;AAClB,UAAI,eAAe,KAAK,CAAC;AAAG;AAC5B,aAAO,CAAC,MAAK,MAAK,MAAK,MAAK,IAAI,EAAE,KAAK,IAAI,GAAG,KAAK,IAAI,QAAM,GAAG,CAAC,CAAC,CAAC;AAAA,IACrE,CAAC;AAED,UAAM,QAAQ;AAAA,MACZ,QAAQ,EAAE,UAAU,MAAM,cAAc,SAAU;AAAA,MAClD,QAAQ;AAAA,QACN,UAAU;AAAA,QACV,cAAc;AAAA,QACd,kBAAkB,CAAC,MAAM,OAAO,MAAM,aAAa;AACjD,gBAAM,IAAI,OAAO,SAAS,EAAE;AAC5B,cAAI,EAAE,SAAS;AAAG,mBAAO,SAAS,MAAM;AACxC,cAAI,CAAC,WAAW,KAAK,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC;AAAG,mBAAO,SAAS,UAAU;AACpE,iBAAO,SAAU;AAAA,QAClB;AAAA,MACF;AAAA,MACD,YAAY;AAAA,QACV,UAAU;AAAA,QACV,cAAc;AAAA,QACd,kBAAkB,CAAC,MAAM,OAAO,MAAM,aAAa;AACjD,cAAI,OAAO,SAAS,EAAE,MAAM,OAAO,KAAK,MAAM,UAAU,EAAE;AAAG,mBAAO,SAAS,SAAS;AACtF,iBAAO,SAAU;AAAA,QAClB;AAAA,MACF;AAAA,IACH;AAEA,mBAAe,eAAe;;AAC5B,UAAI;AACF,gBAAM,mBAAQ,UAAR,mBAAe,aAAf;AAAA,MACP,SAAQ,GAAG;AACV;AAAA,MACD;AACD,iBAAW,QAAQ;AACnB,UAAI;AACF,cAAMC,cAAAA,QAAQ,EAAE,KAAK,yBAAyB,QAAQ,QAAQ,MAAM,EAAE,QAAQ,KAAK,MAAM,QAAQ,QAAQ,KAAK,MAAM,OAAM,GAAI;AAE9HC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS;AAAA,UACT,SAAS,OAAO,QAAQ;AACtB,gBAAI,IAAI,SAAS;AACf,kBAAI;AAAE,sBAAMD,cAAO,QAAC,EAAE,KAAK,gCAAgC,QAAQ,QAAQ,MAAM,CAAA,EAAI,CAAA;AAAA,uBAAW,GAAG;AAAA,cAAE;AAAA,YACtG;AACDC,0BAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,WAAW;AACjD,uBAAW,MAAMA,cAAAA,MAAI,aAAa,EAAE,OAAO,EAAC,CAAE,GAAG,GAAG;AAAA,UACrD;AAAA,QACP,CAAK;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,MACvD,UAAY;AACR,mBAAW,QAAQ;AAAA,MACpB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjHA,GAAG,WAAW,eAAe;"}