{"version":3,"file":"devices.js","sources":["pages/profile/devices.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9kZXZpY2VzLnZ1ZQ"],"sourcesContent":["<!-- 登录设备/会话管理页面（UTF-8，中文注释） -->\n<template>\n  <AppLayout current=\"pages/profile/devices\">\n    <view class=\"profile-page\">\n      <view class=\"profile__card\">\n        <view class=\"profile__card-header\">\n          <uni-icons type=\"phone\" size=\"20\" color=\"#276019\" />\n          <text class=\"profile__card-title\">登录设备管理</text>\n        </view>\n        <view class=\"profile__card-content\">\n          <view v-if=\"loading\" class=\"list-hint\">加载中...</view>\n          <view v-else-if=\"list.length === 0\" class=\"list-hint\">暂无设备</view>\n\n          <view v-for=\"(item, idx) in list\" :key=\"item.id || idx\" class=\"device-row\">\n            <view class=\"device-info\">\n              <view class=\"device-title\">\n                <text class=\"device-name\">{{ item.device || '未知设备' }}</text>\n                <text v-if=\"item.isCurrent\" class=\"tag-current\">当前设备</text>\n              </view>\n              <view class=\"device-sub\">\n                <text>{{ item.os || '-' }} · {{ item.browser || '-' }} · {{ item.ip || '-' }}</text>\n              </view>\n              <view class=\"device-time\">最近活跃：{{ item.activeAt || '-' }}</view>\n            </view>\n            <view class=\"device-actions\">\n              <button class=\"btn-outline\" :disabled=\"item.isCurrent || actingId===item.id\" @tap=\"logoutOne(item)\">{{ item.isCurrent ? '使用中' : (actingId===item.id ? '处理中' : '下线') }}</button>\n            </view>\n          </view>\n\n          <view v-if=\"hasMore\" class=\"load-more\">\n            <button class=\"btn-secondary\" :disabled=\"loadingMore\" @tap=\"loadMore\">{{ loadingMore ? '加载中...' : '加载更多' }}</button>\n          </view>\n        </view>\n      </view>\n\n      <view class=\"actions\">\n        <button class=\"danger-btn\" :disabled=\"actingAll\" @tap=\"logoutOthers\">一键下线其他设备</button>\n      </view>\n\n      <view class=\"safe-area-bottom\" />\n    </view>\n  </AppLayout>\n</template>\n\n<script setup>\n// UTF-8，中文注释\nimport { ref } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport AppLayout from '@/components/layout/AppLayout.vue'\nimport { navTitleStore } from '@/stores/navTitle.js'\nimport { request } from '@/utils/request.js'\n\nconst navTitle = navTitleStore()\nonShow(() => {\n  navTitle.setTitle('设备与会话')\n  init()\n})\n\nconst list = ref([])\nconst page = ref(1)\nconst pageSize = 20\nconst hasMore = ref(false)\nconst loading = ref(false)\nconst loadingMore = ref(false)\nconst actingId = ref(null)\nconst actingAll = ref(false)\n\nasync function init() {\n  page.value = 1\n  list.value = []\n  await fetchList()\n}\n\nasync function fetchList() {\n  if (page.value === 1) loading.value = true\n  try {\n    const res = await request({ url: `/user/sessions?page=${page.value}&size=${pageSize}`, method: 'GET' })\n    const rows = res?.list || []\n    list.value = page.value === 1 ? rows : list.value.concat(rows)\n    const total = res?.page?.total || 0\n    const current = list.value.length\n    hasMore.value = current < total\n  } catch(e) {\n    if (page.value === 1) list.value = []\n    uni.showToast({ title: '加载失败', icon: 'none' })\n  } finally {\n    if (page.value === 1) loading.value = false\n    loadingMore.value = false\n  }\n}\n\nfunction loadMore() {\n  if (!hasMore.value || loadingMore.value) return\n  loadingMore.value = true\n  page.value += 1\n  fetchList()\n}\n\nfunction logoutOne(item) {\n  if (item.isCurrent) return\n  uni.showModal({\n    title: '确认下线',\n    content: '确定将该设备下线吗？',\n    success: async (res) => {\n      if (!res.confirm) return\n      actingId.value = item.id\n      try {\n        await request({ url: '/user/sessions/logout', method: 'POST', data: { id: item.id } })\n        uni.showToast({ title: '已下线', icon: 'success' })\n        // 刷新\n        init()\n      } catch(e) {\n        uni.showToast({ title: '操作失败', icon: 'none' })\n      } finally {\n        actingId.value = null\n      }\n    }\n  })\n}\n\nfunction logoutOthers() {\n  uni.showModal({\n    title: '批量下线',\n    content: '确定下线除当前设备外的所有会话？',\n    success: async (res) => {\n      if (!res.confirm) return\n      actingAll.value = true\n      try {\n        await request({ url: '/user/sessions/logout-others', method: 'POST', data: {} })\n        uni.showToast({ title: '已下线其他设备', icon: 'success' })\n        init()\n      } catch(e) {\n        uni.showToast({ title: '操作失败', icon: 'none' })\n      } finally {\n        actingAll.value = false\n      }\n    }\n  })\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.profile-page { display: flex; flex-direction: column; gap: 24rpx; background-color: #f5f7fa; }\n.profile__card { background-color: #ffffff; border-radius: 20rpx; overflow: hidden; }\n.profile__card-header { display: flex; align-items: center; gap: 16rpx; padding: 32rpx 32rpx 24rpx; border-bottom: 1rpx solid #f1f5f9; }\n.profile__card-title { font-size: 30rpx; font-weight: 600; color: #0f172a; }\n.profile__card-content { padding: 0; }\n\n.device-row { display: flex; justify-content: space-between; gap: 16rpx; padding: 28rpx 32rpx; border-bottom: 1rpx solid #f8fafc; }\n.device-info { flex: 1; min-width: 0; }\n.device-title { display: flex; align-items: center; gap: 12rpx; }\n.device-name { font-size: 28rpx; color: #0f172a; font-weight: 600; max-width: 520rpx; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n.tag-current { font-size: 22rpx; color: #276019; background: #e6f4ea; padding: 4rpx 10rpx; border-radius: 8rpx; }\n.device-sub { font-size: 26rpx; color: #64748b; margin-top: 6rpx; }\n.device-time { font-size: 24rpx; color: #94a3b8; margin-top: 6rpx; }\n\n.device-actions { display: flex; align-items: center; }\n.btn-outline { background: #fff; color: #276019; border: 1rpx solid #d1fae5; padding: 12rpx 20rpx; border-radius: 12rpx; font-size: 26rpx; }\n.btn-outline:disabled { color: #94a3b8; border-color: #e2e8f0; }\n\n.load-more { display: flex; justify-content: center; padding: 20rpx 0 28rpx; }\n.btn-secondary { padding: 16rpx 24rpx; background: #f1f5f9; color: #276019; border: none; border-radius: 12rpx; font-size: 26rpx; }\n\n.actions { padding: 0 24rpx; }\n.danger-btn { width: 100%; background: #fee2e2; color: #b91c1c; border: none; border-radius: 16rpx; padding: 24rpx; font-size: 30rpx; font-weight: 600; }\n\n.list-hint { padding: 32rpx; font-size: 28rpx; color: #94a3b8; text-align: center; }\n.safe-area-bottom { height: env(safe-area-inset-bottom); min-height: 0rpx; }\n</style>\n\n","import MiniProgramPage from 'C:/Users/97247/Desktop/uni-ecoful/pages/profile/devices.vue'\nwx.createPage(MiniProgramPage)"],"names":["navTitleStore","onShow","ref","request","uni"],"mappings":"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"}