{"version":3,"file":"feedback.js","sources":["pages/profile/feedback.vue","../../../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9mZWVkYmFjay52dWU"],"sourcesContent":["<!-- 意见反馈页面（UTF-8，中文注释） -->\n<template>\n  <AppLayout current=\"pages/profile/feedback\">\n    <view class=\"profile-page\">\n      <view class=\"profile__card\">\n        <view class=\"profile__card-header\">\n          <uni-icons type=\"help\" size=\"20\" color=\"#276019\" />\n          <text class=\"profile__card-title\">意见反馈</text>\n        </view>\n        <view class=\"profile__card-content\">\n          <uni-forms :modelValue=\"form\" :rules=\"rules\" ref=\"formRef\">\n            <view class=\"form-row\">\n              <text class=\"form-label\">问题类型</text>\n              <picker mode=\"selector\" :range=\"typeOptions\" :value=\"typeIndex\" @change=\"e=>typeIndex=Number(e.detail.value)\">\n                <view class=\"profile__picker\">{{ typeOptions[typeIndex] }}</view>\n              </picker>\n            </view>\n            <view class=\"form-row\">\n              <text class=\"form-label\">问题描述</text>\n              <uni-easyinput type=\"textarea\" v-model=\"form.content\" placeholder=\"请描述您遇到的问题或建议\" />\n            </view>\n            <view class=\"form-row\">\n              <text class=\"form-label\">联系方式</text>\n              <uni-easyinput v-model=\"form.contact\" placeholder=\"手机号或邮箱（选填）\" />\n            </view>\n            <view class=\"form-row\">\n              <text class=\"form-label\">截图/图片（最多6张）</text>\n              <uni-file-picker v-model=\"files\" fileMediatype=\"image\" mode=\"grid\" :limit=\"6\" />\n            </view>\n          </uni-forms>\n        </view>\n      </view>\n\n      <view class=\"actions\">\n        <button class=\"profile__submit-btn\" :disabled=\"submitting\" @tap=\"handleSubmit\">{{ submitting ? '提交中...' : '提交反馈' }}</button>\n      </view>\n\n      <view class=\"safe-area-bottom\" />\n    </view>\n  </AppLayout>\n</template>\n\n<script setup>\n// UTF-8，中文注释\nimport { ref, watch } from 'vue'\nimport { onShow } from '@dcloudio/uni-app'\nimport AppLayout from '@/components/layout/AppLayout.vue'\nimport { navTitleStore } from '@/stores/navTitle.js'\nimport { request} from '@/utils/request.js'\n\nconst navTitle = navTitleStore()\nonShow(() => navTitle.setTitle('意见反馈'))\n\nconst typeOptions = ['功能建议', 'BUG问题', '体验优化', '其他']\nlet typeIndex = ref(0)\n\nconst formRef = ref(null)\nconst form = ref({ type: typeOptions[0], content: '', contact: '' })\nwatch(typeIndex, (idx) => { form.value.type = typeOptions[idx] })\n\nconst files = ref([]) // uni-file-picker 绑定的文件列表\nconst submitting = ref(false)\n\nconst rules = {\n  content: {\n    required: true,\n    errorMessage: '请填写问题描述',\n    validateFunction: (rule, value, data, callback) => {\n      const v = String(value || '').trim()\n      if (v.length < 10) return callback('请至少填写10个字')\n      callback()\n    }\n  }\n}\n\nasync function uploadAll() {\n  if (!files.value || files.value.length === 0) return []\n  const list = []\n  for (const f of files.value) {\n    const path = f.url || f.path || f.tempFilePath\n    if (!path) continue\n    try {\n      const res = await new Promise((resolve, reject) => {\n        uni.uploadFile({\n          url: BASE_URL + '/upload',\n          filePath: path,\n          name: 'file',\n          success: (r) => {\n            try {\n              const data = JSON.parse(r.data || '{}')\n              resolve(data)\n            } catch (e) { resolve({ url: '' }) }\n          },\n          fail: reject\n        })\n      })\n      if (res?.url) list.push({ url: res.url, id: res.id })\n    } catch (e) {}\n  }\n  return list\n}\n\nasync function handleSubmit() {\n  try { await formRef.value?.validate?.() } catch (e) { return }\n  submitting.value = true\n  try {\n    const images = await uploadAll()\n    const payload = { ...form.value, images }\n    const res = await request({ url: '/feedback/create', method: 'POST', data: payload })\n    const ticket = res?.ticketId ? `（单号：${res.ticketId}）` : ''\n    uni.showToast({ title: `提交成功${ticket}`, icon: 'success' })\n    setTimeout(() => uni.navigateBack({ delta: 1 }), 800)\n  } catch (e) {\n    uni.showToast({ title: '提交失败，请稍后再试', icon: 'none' })\n  } finally {\n    submitting.value = false\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.profile-page { display: flex; flex-direction: column; gap: 24rpx; background-color: #f5f7fa; }\n.profile__card { background-color: #ffffff; border-radius: 20rpx; overflow: hidden; }\n.profile__card-header { display: flex; align-items: center; gap: 16rpx; padding: 32rpx 32rpx 24rpx; border-bottom: 1rpx solid #f1f5f9; }\n.profile__card-title { font-size: 30rpx; font-weight: 600; color: #0f172a; }\n.profile__card-content { padding: 0; }\n\n.form-row { display: flex; flex-direction: column; gap: 16rpx; padding: 24rpx 32rpx; }\n.form-label { font-size: 28rpx; color: #334155; }\n.profile__picker { padding: 16rpx 24rpx; border-radius: 16rpx; background-color: #f8fafc; color: #276019; font-size: 28rpx; font-weight: 500; min-width: 200rpx; text-align: left; }\n\n.actions { padding: 0 24rpx; }\n.profile__submit-btn { width: 100%; background: #276019; color: #fff; border: none; border-radius: 16rpx; padding: 24rpx; font-size: 32rpx; font-weight: 600; }\n.profile__submit-btn:active { opacity: .9; transform: scale(.98); }\n.safe-area-bottom { height: env(safe-area-inset-bottom); min-height: 0rpx; }\n</style>\n\n","import MiniProgramPage from 'C:/Users/97247/Desktop/uni-ecoful/pages/profile/feedback.vue'\nwx.createPage(MiniProgramPage)"],"names":["navTitleStore","onShow","ref","watch","uni","request"],"mappings":";;;;;;;;;;;;;;;;;;AA8CA,MAAM,YAAY,MAAW;;;;AAI7B,UAAM,WAAWA,gBAAAA,cAAe;AAChCC,kBAAM,OAAC,MAAM,SAAS,SAAS,MAAM,CAAC;AAEtC,UAAM,cAAc,CAAC,QAAQ,SAAS,QAAQ,IAAI;AAClD,QAAI,YAAYC,cAAG,IAAC,CAAC;AAErB,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,OAAOA,cAAG,IAAC,EAAE,MAAM,YAAY,CAAC,GAAG,SAAS,IAAI,SAAS,IAAI;AACnEC,kBAAAA,MAAM,WAAW,CAAC,QAAQ;AAAE,WAAK,MAAM,OAAO,YAAY,GAAG;AAAA,KAAG;AAEhE,UAAM,QAAQD,cAAG,IAAC,EAAE;AACpB,UAAM,aAAaA,cAAG,IAAC,KAAK;AAE5B,UAAM,QAAQ;AAAA,MACZ,SAAS;AAAA,QACP,UAAU;AAAA,QACV,cAAc;AAAA,QACd,kBAAkB,CAAC,MAAM,OAAO,MAAM,aAAa;AACjD,gBAAM,IAAI,OAAO,SAAS,EAAE,EAAE,KAAM;AACpC,cAAI,EAAE,SAAS;AAAI,mBAAO,SAAS,WAAW;AAC9C,mBAAU;AAAA,QACX;AAAA,MACF;AAAA,IACH;AAEA,mBAAe,YAAY;AACzB,UAAI,CAAC,MAAM,SAAS,MAAM,MAAM,WAAW;AAAG,eAAO,CAAE;AACvD,YAAM,OAAO,CAAE;AACf,iBAAW,KAAK,MAAM,OAAO;AAC3B,cAAM,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE;AAClC,YAAI,CAAC;AAAM;AACX,YAAI;AACF,gBAAM,MAAM,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACjDE,0BAAAA,MAAI,WAAW;AAAA,cACb,KAAK,WAAW;AAAA,cAChB,UAAU;AAAA,cACV,MAAM;AAAA,cACN,SAAS,CAAC,MAAM;AACd,oBAAI;AACF,wBAAM,OAAO,KAAK,MAAM,EAAE,QAAQ,IAAI;AACtC,0BAAQ,IAAI;AAAA,gBAC1B,SAAqB,GAAG;AAAE,0BAAQ,EAAE,KAAK,GAAE,CAAE;AAAA,gBAAG;AAAA,cACrC;AAAA,cACD,MAAM;AAAA,YAChB,CAAS;AAAA,UACT,CAAO;AACD,cAAI,2BAAK;AAAK,iBAAK,KAAK,EAAE,KAAK,IAAI,KAAK,IAAI,IAAI,GAAE,CAAE;AAAA,QAC1D,SAAa,GAAG;AAAA,QAAE;AAAA,MACf;AACD,aAAO;AAAA,IACT;AAEA,mBAAe,eAAe;;AAC5B,UAAI;AAAE,gBAAM,mBAAQ,UAAR,mBAAe,aAAf;AAAA,MAA2B,SAAU,GAAG;AAAE;AAAA,MAAQ;AAC9D,iBAAW,QAAQ;AACnB,UAAI;AACF,cAAM,SAAS,MAAM,UAAW;AAChC,cAAM,UAAU,EAAE,GAAG,KAAK,OAAO,OAAQ;AACzC,cAAM,MAAM,MAAMC,cAAO,QAAC,EAAE,KAAK,oBAAoB,QAAQ,QAAQ,MAAM,SAAS;AACpF,cAAM,UAAS,2BAAK,YAAW,OAAO,IAAI,QAAQ,MAAM;AACxDD,4BAAI,UAAU,EAAE,OAAO,OAAO,MAAM,IAAI,MAAM,WAAW;AACzD,mBAAW,MAAMA,cAAAA,MAAI,aAAa,EAAE,OAAO,EAAC,CAAE,GAAG,GAAG;AAAA,MACrD,SAAQ,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,MACvD,UAAY;AACR,mBAAW,QAAQ;AAAA,MACpB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpHA,GAAG,WAAW,eAAe;"}