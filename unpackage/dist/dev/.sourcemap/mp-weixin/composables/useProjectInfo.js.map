{"version":3,"file":"useProjectInfo.js","sources":["composables/useProjectInfo.js"],"sourcesContent":["import { ref, reactive, computed, watch } from 'vue'\r\nimport { runTask, transformExtractResult, downloadSignboardWord } from '@/api/acceptance.js'\r\nimport { getProjects, getProjectDocuments } from '@/api/project.js'\r\nimport { useMonitorPlan } from '@/composables/useMonitorPlan.js'\r\nimport { useAcceptanceReport } from '@/composables/useAcceptanceReport.js'\r\nimport { useFieldSurveyData } from '@/composables/useFieldSurveyData.js'\r\n\r\n/**\r\n * È°πÁõÆ‰ø°ÊÅØÁÆ°ÁêÜ Composable\r\n * ÁÆ°ÁêÜÈ™åÊî∂Êä•ÂëäÁ¨¨‰∏ÄÊ≠•ÔºàÈ°πÁõÆÈÄâÊã©„ÄÅ‰ø°ÊÅØÊèêÂèñ„ÄÅÊ†áËØÜÁâåÔºâÁöÑÊâÄÊúâÁä∂ÊÄÅÂíå‰∏öÂä°ÈÄªËæë\r\n */\r\n\r\n// ÂàõÂª∫Âçï‰æãÁä∂ÊÄÅÔºàÁ°Æ‰øùÊâÄÊúâÁªÑ‰ª∂ÂÖ±‰∫´Âêå‰∏Ä‰ªΩÊï∞ÊçÆÔºâ\r\nlet instance = null\r\n\r\nexport function useProjectInfo() {\r\n\t// Â¶ÇÊûúÂ∑≤ÁªèÂàõÂª∫ËøáÂÆû‰æãÔºåÁõ¥Êé•ËøîÂõû\r\n\tif (instance) {\r\n\t\treturn instance\r\n\t}\r\n\r\n\t// ===== È°πÁõÆÈÄâÊã©Áõ∏ÂÖ≥Áä∂ÊÄÅ =====\r\n\tconst selectedProjectId = ref(null) // ÈÄâ‰∏≠ÁöÑÈ°πÁõÆID\r\n\tconst selectedProject = ref(null) // ÈÄâ‰∏≠ÁöÑÈ°πÁõÆÂØπË±°\r\n\tconst projectList = ref([]) // ÂÆåÊï¥È°πÁõÆÂàóË°®\r\n\tconst projectFiles = ref([]) // È°πÁõÆÊñá‰ª∂ÂàóË°®\r\n\tconst projectSearchKeyword = ref('') // ÊêúÁ¥¢ÂÖ≥ÈîÆËØç\r\n\tconst projectPickerPopup = ref(null) // ÂºπÁ™óÂºïÁî®\r\n\r\n\t// Êñá‰ª∂Áä∂ÊÄÅËΩÆËØ¢Áõ∏ÂÖ≥\r\n\tconst pollingTimer = ref(null) // ËΩÆËØ¢ÂÆöÊó∂Âô®\r\n\tconst isPolling = ref(false) // ÊòØÂê¶Ê≠£Âú®ËΩÆËØ¢\r\n\tconst pollingCount = ref(0) // ËΩÆËØ¢Ê¨°Êï∞\r\n\tconst MAX_POLLING_COUNT = 100 // ÊúÄÂ§öËΩÆËØ¢100Ê¨°ÔºàÁ∫¶5ÂàÜÈíüÔºâ\r\n\tconst POLLING_INTERVAL = 3000 // ËΩÆËØ¢Èó¥ÈöîÔºà3ÁßíÔºâ\r\n\r\n\t// ===== ‰ø°ÊÅØÊèêÂèñÁõ∏ÂÖ≥Áä∂ÊÄÅ =====\r\n\tconst extracting = ref(false) // ÊèêÂèñÁä∂ÊÄÅ\r\n\tconst extractionOk = ref(false) // ÊèêÂèñÂÆåÊàêÊ†áÂøó\r\n\tconst baseTable = ref([]) // È°πÁõÆÂü∫Êú¨‰ø°ÊÅØË°® - ÂøÖÈ°ªÊòØÊï∞ÁªÑ\r\n\r\n\t// ‰ªªÂä°ËøõÂ∫¶ÂºπÁ™óÁõ∏ÂÖ≥Áä∂ÊÄÅ\r\n\tconst taskProgressTitle = ref('‰ø°ÊÅØÊèêÂèñ‰∏≠')\r\n\tconst taskProgress = ref(0)\r\n\tconst taskStatusText = ref('Ê≠£Âú®ÂàùÂßãÂåñ...')\r\n\tconst taskState = ref('running')\r\n\r\n\t// Êñ∞Â¢ûÈ°πÁõÆÂü∫Êú¨‰ø°ÊÅØÂºπÁ™ó\r\n\tconst newBaseInfoPopup = ref(null)\r\n\tconst newBaseInfoLabel = ref('')\r\n\r\n\t// ÈÄâÊã©Âà†Èô§Ê®°Âºè\r\n\tconst selectMode = ref(false)\r\n\tconst selectedIds = ref([])\r\n\r\n\t// ===== Ê†áËØÜÁâåÁõ∏ÂÖ≥Áä∂ÊÄÅ =====\r\n\tconst showSignboard = ref(false)\r\n\tconst signboard = reactive({\r\n\t\tsections: [\r\n\t\t\t{ block: 'Â∫üÊ∞¥', items: [{ title: '', content: '' }] },\r\n\t\t\t{ block: 'Â∫üÊ∞î', items: [{ title: '', content: '' }] },\r\n\t\t\t{ block: 'Âô™Â£∞', items: [{ title: '', content: '' }] },\r\n\t\t\t{ block: 'Âç±Èô©Â∫üÁâ©', items: [{ title: '', content: '' }] }\r\n\t\t]\r\n\t})\r\n\r\n\t// ===== ËÆ°ÁÆóÂ±ûÊÄß =====\r\n\t// ËøáÊª§ÂêéÁöÑÈ°πÁõÆÂàóË°®ÔºàÊ†πÊçÆÊêúÁ¥¢ÂÖ≥ÈîÆËØçÔºâ\r\n\tconst filteredProjects = computed(() => {\r\n\t\tif (!projectSearchKeyword.value) {\r\n\t\t\treturn projectList.value\r\n\t\t}\r\n\t\tconst keyword = projectSearchKeyword.value.toLowerCase().trim()\r\n\t\treturn projectList.value.filter(project => {\r\n\t\t\tconst name = (project.name || '').toLowerCase()\r\n\t\t\tconst desc = (project.description || '').toLowerCase()\r\n\t\t\tconst folder = (project.folder_name || '').toLowerCase()\r\n\t\t\treturn name.includes(keyword) || desc.includes(keyword) || folder.includes(keyword)\r\n\t\t})\r\n\t})\r\n\r\n\t// ===== È°πÁõÆÈÄâÊã©Áõ∏ÂÖ≥ÊñπÊ≥ï =====\r\n\t\r\n\t// Âä†ËΩΩÈ°πÁõÆÂàóË°®\r\n\tasync function loadProjects() {\r\n\t\ttry {\r\n\t\t\tconst response = await getProjects()\r\n\t\t\tprojectList.value = response || []\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Âä†ËΩΩÈ°πÁõÆÂàóË°®Â§±Ë¥•:', error)\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'Âä†ËΩΩÈ°πÁõÆÂàóË°®Â§±Ë¥•',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t// Âä†ËΩΩÈ°πÁõÆÊñá‰ª∂ÂàóË°®\r\n\tasync function loadProjectFiles(projectId, silent = false) {\r\n\t\ttry {\r\n\t\t\tif (!silent) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'Âä†ËΩΩÊñá‰ª∂ÂàóË°®...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tconst response = await getProjectDocuments(projectId)\r\n\r\n\t\t\tif (Array.isArray(response)) {\r\n\t\t\t\tprojectFiles.value = response\r\n\t\t\t} else if (response && Array.isArray(response.documents)) {\r\n\t\t\t\tprojectFiles.value = response.documents\r\n\t\t\t} else {\r\n\t\t\t\tprojectFiles.value = []\r\n\t\t\t}\r\n\r\n\t\t\tif (!silent) {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t\tif (projectFiles.value.length === 0) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'ËØ•È°πÁõÆÊöÇÊó†Êñá‰ª∂',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Âä†ËΩΩÈ°πÁõÆÊñá‰ª∂Â§±Ë¥•:', error)\r\n\t\t\tif (!silent) {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: 'Âä†ËΩΩÊñá‰ª∂ÂàóË°®Â§±Ë¥•',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tprojectFiles.value = []\r\n\t\t}\r\n\t}\r\n\r\n\t// Ê£ÄÊü•ÊòØÂê¶ÊúâÊñá‰ª∂Ê≠£Âú®Â§ÑÁêÜ\r\n\tfunction hasProcessingFiles() {\r\n\t\treturn projectFiles.value.some(file =>\r\n\t\t\t!['indexed', 'failed'].includes(file.status)\r\n\t\t)\r\n\t}\r\n\r\n\t// ÂºÄÂßãËΩÆËØ¢Êñá‰ª∂Áä∂ÊÄÅ\r\n\tfunction startPollingFileStatus(projectId) {\r\n\t\tif (!hasProcessingFiles()) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (isPolling.value) {\r\n\t\t\tconsole.log('‚ö†Ô∏è Â∑≤Âú®ËΩÆËØ¢‰∏≠ÔºåË∑≥Ëøá')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tisPolling.value = true\r\n\t\tpollingCount.value = 0\r\n\r\n\t\tpollingTimer.value = setInterval(async () => {\r\n\t\t\tpollingCount.value++\r\n\r\n\t\t\tif (pollingCount.value > MAX_POLLING_COUNT) {\r\n\t\t\t\tconsole.log('‚è∞ ËææÂà∞ÊúÄÂ§ßËΩÆËØ¢Ê¨°Êï∞ÔºåÂÅúÊ≠¢ËΩÆËØ¢')\r\n\t\t\t\tstopPolling()\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: 'Êñá‰ª∂Â§ÑÁêÜË∂ÖÊó∂ÔºåËØ∑ÊâãÂä®Âà∑Êñ∞',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 2000\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tawait loadProjectFiles(projectId, true)\r\n\r\n\t\t\t\tif (!hasProcessingFiles()) {\r\n\t\t\t\t\tconsole.log('‚úÖ ÊâÄÊúâÊñá‰ª∂Â§ÑÁêÜÂÆåÊàêÔºåÂÅúÊ≠¢ËΩÆËØ¢')\r\n\t\t\t\t\tstopPolling()\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'Êñá‰ª∂Â§ÑÁêÜÂÆåÊàê',\r\n\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('‚ùå ËΩÆËØ¢Êñá‰ª∂Áä∂ÊÄÅÂ§±Ë¥•:', error)\r\n\t\t\t}\r\n\t\t}, POLLING_INTERVAL)\r\n\t}\r\n\r\n\t// ÂÅúÊ≠¢ËΩÆËØ¢\r\n\tfunction stopPolling() {\r\n\t\tif (pollingTimer.value) {\r\n\t\t\tclearInterval(pollingTimer.value)\r\n\t\t\tpollingTimer.value = null\r\n\t\t}\r\n\t\tisPolling.value = false\r\n\t\tpollingCount.value = 0\r\n\t}\r\n\r\n\t// ÊâìÂºÄÈ°πÁõÆÈÄâÊã©Âô®ÂºπÁ™ó\r\n\tfunction openProjectPicker() {\r\n\t\tif (projectList.value.length === 0) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'ÊöÇÊó†È°πÁõÆÔºåËØ∑ÂÖàÂàõÂª∫È°πÁõÆ',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tprojectSearchKeyword.value = ''\r\n\t\t// Ê≥®ÊÑèÔºöÂºπÁ™óÁöÑÊâìÂºÄÈúÄË¶ÅÂú®ÁªÑ‰ª∂‰∏≠ÈÄöËøá ref Ë∞ÉÁî®\r\n\t\treturn true\r\n\t}\r\n\r\n\t// ÂÖ≥Èó≠È°πÁõÆÈÄâÊã©Âô®ÂºπÁ™ó\r\n\tfunction closeProjectPicker() {\r\n\t\t// Ê≥®ÊÑèÔºöÂºπÁ™óÁöÑÂÖ≥Èó≠ÈúÄË¶ÅÂú®ÁªÑ‰ª∂‰∏≠ÈÄöËøá ref Ë∞ÉÁî®\r\n\t\treturn true\r\n\t}\r\n\r\n\t// ÈÄâÊã©È°πÁõÆ\r\n\tasync function selectProject(project) {\r\n\t\tselectedProjectId.value = project.id\r\n\t\tselectedProject.value = project\r\n\r\n\t\ttry {\r\n\t\t\tuni.setStorageSync('acceptance_project_id', project.id)\r\n\t\t\tuni.setStorageSync('acceptance_project_info', JSON.stringify({\r\n\t\t\t\tid: project.id,\r\n\t\t\t\tname: project.name,\r\n\t\t\t\tdescription: project.description,\r\n\t\t\t\tfolder_name: project.folder_name\r\n\t\t\t}))\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn('‚ö†Ô∏è ‰øùÂ≠òÈ°πÁõÆÈÄâÊã©Â§±Ë¥•:', e)\r\n\t\t}\r\n\r\n\t\tstopPolling()\r\n\t\tawait loadProjectFiles(project.id)\r\n\t\tstartPollingFileStatus(project.id)\r\n\t\tloadProjectCache(project.id)\r\n\r\n\t\tuni.showToast({\r\n\t\t\ttitle: `Â∑≤ÈÄâÊã©Ôºö${project.name}`,\r\n\t\t\ticon: 'success',\r\n\t\t\tduration: 1500\r\n\t\t})\r\n\r\n\t\treturn true // ËøîÂõûtrueË°®Á§∫ÈÄâÊã©ÊàêÂäüÔºåÁªÑ‰ª∂ÂèØ‰ª•ÂÖ≥Èó≠ÂºπÁ™ó\r\n\t}\r\n\r\n\t// ÊêúÁ¥¢ËæìÂÖ•Â§ÑÁêÜ\r\n\tfunction onSearchInput() {\r\n\t\tconsole.log('ÊêúÁ¥¢ÂÖ≥ÈîÆËØç:', projectSearchKeyword.value)\r\n\t}\r\n\r\n\t// ===== Êñá‰ª∂Â∑•ÂÖ∑ÊñπÊ≥ï =====\r\n\t\r\n\t// Êñá‰ª∂ÂõæÊ†áÊò†Â∞Ñ\r\n\tfunction getFileIcon(extension) {\r\n\t\tconst ext = (extension || '').toLowerCase().replace('.', '')\r\n\t\tconst iconMap = {\r\n\t\t\t'pdf': 'paperplane',\r\n\t\t\t'doc': 'compose',\r\n\t\t\t'docx': 'compose',\r\n\t\t\t'xls': 'bars',\r\n\t\t\t'xlsx': 'bars',\r\n\t\t\t'ppt': 'image',\r\n\t\t\t'pptx': 'image',\r\n\t\t\t'md': 'compose',\r\n\t\t\t'txt': 'compose',\r\n\t\t\t'jpg': 'image',\r\n\t\t\t'jpeg': 'image',\r\n\t\t\t'png': 'image',\r\n\t\t\t'gif': 'image'\r\n\t\t}\r\n\t\treturn iconMap[ext] || 'paperclip'\r\n\t}\r\n\r\n\t// Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è\r\n\tfunction formatFileSize(bytes) {\r\n\t\tif (!bytes) return '0 B'\r\n\t\tconst k = 1024\r\n\t\tconst sizes = ['B', 'KB', 'MB', 'GB']\r\n\t\tconst i = Math.floor(Math.log(bytes) / Math.log(k))\r\n\t\treturn Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i]\r\n\t}\r\n\r\n\t// Ê†ºÂºèÂåñÊñá‰ª∂Áä∂ÊÄÅ\r\n\tfunction formatFileStatus(status) {\r\n\t\tconst statusMap = {\r\n\t\t\t'uploaded': 'Â∑≤‰∏ä‰º†',\r\n\t\t\t'converting': 'ËΩ¨Êç¢‰∏≠',\r\n\t\t\t'converted': 'Â∑≤ËΩ¨Êç¢',\r\n\t\t\t'vectorizing': 'ÂêëÈáèÂåñ‰∏≠',\r\n\t\t\t'indexed': 'Â∑≤Á¥¢Âºï',\r\n\t\t\t'failed': 'Â§ÑÁêÜÂ§±Ë¥•'\r\n\t\t}\r\n\t\treturn statusMap[status] || status\r\n\t}\r\n\r\n\t// Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨\r\n\tfunction getStatusText(status) {\r\n\t\tconst statusMap = {\r\n\t\t\t'uploaded': 'Â∑≤‰∏ä‰º†',\r\n\t\t\t'converting': 'ËΩ¨Êç¢‰∏≠',\r\n\t\t\t'converted': 'Â∑≤ËΩ¨Êç¢',\r\n\t\t\t'vectorizing': 'Â§ÑÁêÜ‰∏≠',\r\n\t\t\t'indexed': '‚úì Â∑≤Â∞±Áª™',\r\n\t\t\t'failed': 'Â§±Ë¥•'\r\n\t\t}\r\n\t\treturn statusMap[status] || status\r\n\t}\r\n\r\n\t// Ëé∑ÂèñÁä∂ÊÄÅÊ†∑ÂºèÁ±ª\r\n\tfunction getStatusClass(status) {\r\n\t\tconst classMap = {\r\n\t\t\t'uploaded': 'status-uploaded',\r\n\t\t\t'converting': 'status-processing',\r\n\t\t\t'converted': 'status-processing',\r\n\t\t\t'vectorizing': 'status-processing',\r\n\t\t\t'indexed': 'status-success',\r\n\t\t\t'failed': 'status-error'\r\n\t\t}\r\n\t\treturn classMap[status] || ''\r\n\t}\r\n\r\n\t// ===== ÁºìÂ≠òÁÆ°ÁêÜÊñπÊ≥ï =====\r\n\t\r\n\t// Âä†ËΩΩÈ°πÁõÆÁºìÂ≠òÊï∞ÊçÆ\r\n\tfunction loadProjectCache(projectId) {\r\n\t\tif (!projectId) return\r\n\r\n\t\tconst cacheKey = `project_base_info_${projectId}`\r\n\t\tconst cachedData = uni.getStorageSync(cacheKey)\r\n\r\n\t\tif (cachedData) {\r\n\t\t\ttry {\r\n\t\t\t\tconst parsedData = JSON.parse(cachedData)\r\n\t\t\t\t\r\n\t\t\t\t// ‚úÖ Êï∞ÊçÆÊ†ºÂºèÈ™åËØÅÔºöÁ°Æ‰øùÊòØÊï∞ÁªÑ\r\n\t\t\t\tif (Array.isArray(parsedData)) {\r\n\t\t\t\t\tbaseTable.value = parsedData\r\n\t\t\t\t} else if (typeof parsedData === 'object' && parsedData !== null) {\r\n\t\t\t\t\t// Â¶ÇÊûúÊòØÊóßÊ†ºÂºèÁöÑÂØπË±°ÔºåËΩ¨Êç¢‰∏∫Êï∞ÁªÑÊ†ºÂºè\r\n\t\t\t\t\tconst converted = transformExtractResult(parsedData)\r\n\t\t\t\t\tif (Array.isArray(converted)) {\r\n\t\t\t\t\t\tbaseTable.value = converted\r\n\t\t\t\t\t\t// Êõ¥Êñ∞ÁºìÂ≠ò‰∏∫Êñ∞Ê†ºÂºè\r\n\t\t\t\t\t\tuni.setStorageSync(cacheKey, JSON.stringify(baseTable.value))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbaseTable.value = []\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbaseTable.value = []\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// ÊúÄÁªàÈ™åËØÅÔºöÁ°Æ‰øù baseTable.value ÊòØÊï∞ÁªÑ\r\n\t\t\t\tif (!Array.isArray(baseTable.value)) {\r\n\t\t\t\t\tbaseTable.value = []\r\n\t\t\t\t\textractionOk.value = false\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\textractionOk.value = true\r\n\t\t\t\tconsole.log(`‚úÖ Â∑≤Âä†ËΩΩÈ°πÁõÆ ${projectId} ÁöÑÁºìÂ≠òÊï∞ÊçÆÔºåÂÖ± ${baseTable.value.length} Êù°`)\r\n\r\n\t\t\t\t// Ëá™Âä®ÊèêÂèñÊ±°ÊüìÊ≤ªÁêÜËÆæÊñΩÂà∞Áé∞Âú∫Ë∏èÂãò\r\n\t\t\t\tconst fieldSurveyData = useFieldSurveyData()\r\n\t\t\t\tfieldSurveyData.extractFacilitiesFromBaseTable(projectId, baseTable.value)\r\n\r\n\t\t\t\t// Âä†ËΩΩÁõëÊµãÊñπÊ°àÁºìÂ≠ò\r\n\t\t\t\tconst monitorPlanState = useMonitorPlan()\r\n\t\t\t\tmonitorPlanState.loadPlanCache(projectId)\r\n\t\t\t\t\r\n\t\t\t\t// Âä†ËΩΩÁ´£Â∑•È™åÊî∂Êä•ÂëäÁºìÂ≠ò\r\n\t\t\t\tconst acceptanceReportState = useAcceptanceReport()\r\n\t\t\t\tacceptanceReportState.loadReportCache(projectId)\r\n\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: 'Â∑≤Âä†ËΩΩÁºìÂ≠òÊï∞ÊçÆ',\r\n\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\tduration: 1500\r\n\t\t\t\t})\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('Ëß£ÊûêÁºìÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error)\r\n\t\t\t\tbaseTable.value = []\r\n\t\t\t\textractionOk.value = false\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tbaseTable.value = []\r\n\t\t\textractionOk.value = false\r\n\t\t\tconsole.log(`‚ÑπÔ∏è È°πÁõÆ ${projectId} ÊöÇÊó†ÁºìÂ≠òÊï∞ÊçÆ`)\r\n\t\t}\r\n\t}\r\n\r\n\t// Ê∏ÖÈô§ÂΩìÂâçÈ°πÁõÆÁöÑÁºìÂ≠ò\r\n\tfunction clearProjectCache() {\r\n\t\tif (!selectedProjectId.value) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'ËØ∑ÂÖàÈÄâÊã©È°πÁõÆ',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tuni.showModal({\r\n\t\t\ttitle: 'Ê∏ÖÈô§ÁºìÂ≠ò',\r\n\t\t\tcontent: 'Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÂΩìÂâçÈ°πÁõÆÁöÑÊâÄÊúâÁºìÂ≠òÊï∞ÊçÆÂêóÔºüÊ∏ÖÈô§ÂêéÈúÄË¶ÅÈáçÊñ∞ÊèêÂèñ‰ø°ÊÅØ„ÄÇ',\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tconst cacheKey = `project_base_info_${selectedProjectId.value}`\r\n\t\t\t\t\tuni.removeStorageSync(cacheKey)\r\n\t\t\t\t\tuni.removeStorageSync('acceptance_project_id')\r\n\t\t\t\t\tuni.removeStorageSync('acceptance_project_info')\r\n\r\n\t\t\t\t\t// Ê∏ÖÈô§ÁõëÊµãÊñπÊ°àÁºìÂ≠ò\r\n\t\t\t\t\tconst monitorPlanState = useMonitorPlan()\r\n\t\t\t\t\tmonitorPlanState.clearPlanCache(selectedProjectId.value)\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Ê∏ÖÈô§Áé∞Âú∫Ë∏èÂãòÁõ∏ÂÖ≥ÁºìÂ≠ò\r\n\t\t\t\t\tconst fieldSurveyData = useFieldSurveyData()\r\n\t\t\t\t\tconst facilityKey = `project_facility_list_${selectedProjectId.value}`\r\n\t\t\t\t\tconst outletKey = `project_outlet_list_${selectedProjectId.value}`\r\n\t\t\t\t\tuni.removeStorageSync(facilityKey)\r\n\t\t\t\t\tuni.removeStorageSync(outletKey)\r\n\r\n\t\t\t\t\t// ÈáçÁΩÆÁä∂ÊÄÅ‰∏∫Á©∫Êï∞ÁªÑÔºà‰∏çÊòØÂØπË±°ÔºÅÔºâ\r\n\t\t\t\t\tbaseTable.value = []\r\n\t\t\t\t\tsignboard.sections.forEach(sec => (sec.items = []))\r\n\t\t\t\t\tshowSignboard.value = false\r\n\t\t\t\t\textractionOk.value = false\r\n\t\t\t\t\tselectedProjectId.value = null\r\n\t\t\t\t\tselectedProject.value = null\r\n\t\t\t\t\tprojectFiles.value = []\r\n\r\n\t\t\t\t\tconsole.log(`üóëÔ∏è Â∑≤Ê∏ÖÈô§È°πÁõÆÁºìÂ≠òÂíåÈÄâÊã©`)\r\n\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'ÁºìÂ≠òÂ∑≤Ê∏ÖÈô§',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// ===== ‰ø°ÊÅØÊèêÂèñÁõ∏ÂÖ≥ÊñπÊ≥ï =====\r\n\t\r\n\t// ËøõÂ∫¶Âπ≥ÊªëÂ§ÑÁêÜÂèòÈáè\r\n\tlet smoothProgressTimer = null\r\n\tlet currentDisplayProgress = 0\r\n\tlet targetProgress = 0\r\n\tlet lastTargetProgress = 0\r\n\tlet lastUpdateTime = 0\r\n\r\n\t// Âπ≥ÊªëÊõ¥Êñ∞ËøõÂ∫¶Êù°\r\n\tfunction updateProgressSmooth(newProgress, statusText, state = 'running') {\r\n\t\tconst progressChanged = newProgress !== lastTargetProgress\r\n\r\n\t\ttargetProgress = newProgress\r\n\t\ttaskStatusText.value = statusText\r\n\t\ttaskState.value = state\r\n\r\n\t\tif (progressChanged) {\r\n\t\t\tlastUpdateTime = Date.now()\r\n\t\t\tlastTargetProgress = newProgress\r\n\t\t\tconsole.log(`[ËøõÂ∫¶ÁúüÂÆûÊõ¥Êñ∞] ${newProgress}% - ${statusText}`)\r\n\t\t}\r\n\r\n\t\tif (!smoothProgressTimer) {\r\n\t\t\tsmoothProgressTimer = setInterval(() => {\r\n\t\t\t\tconst now = Date.now()\r\n\t\t\t\tconst timeSinceLastUpdate = now - lastUpdateTime\r\n\r\n\t\t\t\tif (currentDisplayProgress < targetProgress) {\r\n\t\t\t\t\tconst diff = targetProgress - currentDisplayProgress\r\n\t\t\t\t\tconst step = Math.max(0.5, diff / 10)\r\n\t\t\t\t\tcurrentDisplayProgress = Math.min(currentDisplayProgress + step, targetProgress)\r\n\t\t\t\t} else if (currentDisplayProgress >= targetProgress && targetProgress < 100) {\r\n\t\t\t\t\tif (timeSinceLastUpdate > 5000) {\r\n\t\t\t\t\t\tconst maxAllowedProgress = Math.min(targetProgress + 5, 99)\r\n\t\t\t\t\t\tif (currentDisplayProgress < maxAllowedProgress) {\r\n\t\t\t\t\t\t\tcurrentDisplayProgress += 0.1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttaskProgress.value = Math.floor(currentDisplayProgress)\r\n\r\n\t\t\t\tif (currentDisplayProgress >= 99.9 && targetProgress >= 100) {\r\n\t\t\t\t\tclearInterval(smoothProgressTimer)\r\n\t\t\t\t\tsmoothProgressTimer = null\r\n\t\t\t\t\tcurrentDisplayProgress = 100\r\n\t\t\t\t\ttaskProgress.value = 100\r\n\t\t\t\t\ttaskState.value = 'success'\r\n\t\t\t\t\ttaskStatusText.value = '‰ø°ÊÅØÊèêÂèñÂÆåÊàê'\r\n\t\t\t\t}\r\n\t\t\t}, 50)\r\n\t\t}\r\n\t}\r\n\r\n\t// Ê∏ÖÁêÜËøõÂ∫¶ËÆ°Êó∂Âô®\r\n\tfunction clearProgressTimer() {\r\n\t\tif (smoothProgressTimer) {\r\n\t\t\tclearInterval(smoothProgressTimer)\r\n\t\t\tsmoothProgressTimer = null\r\n\t\t}\r\n\t\tcurrentDisplayProgress = 0\r\n\t\ttargetProgress = 0\r\n\t\tlastTargetProgress = 0\r\n\t\tlastUpdateTime = 0\r\n\t\ttaskProgress.value = 0\r\n\t\ttaskStatusText.value = 'Ê≠£Âú®ÂàùÂßãÂåñ...'\r\n\t\ttaskState.value = 'running'\r\n\t}\r\n\r\n\t// ÊèêÂèñ‰ø°ÊÅØÂà∞È°πÁõÆÂü∫Êú¨Ë°®\r\n\tasync function simulateExtract(taskProgressModalRef) {\r\n\t\tif (!selectedProjectId.value) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: 'ÊèêÁ§∫',\r\n\t\t\t\tcontent: 'ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™È°πÁõÆ',\r\n\t\t\t\tshowCancel: false,\r\n\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (projectFiles.value.length === 0) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: 'ÊèêÁ§∫',\r\n\t\t\t\tcontent: 'ËØ•È°πÁõÆÊöÇÊó†Êñá‰ª∂ÔºåËØ∑ÂÖàÂú®È°πÁõÆÁÆ°ÁêÜÊ®°Âùó‰∏ä‰º†Êñá‰ª∂',\r\n\t\t\t\tshowCancel: false,\r\n\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst hasIndexedFiles = projectFiles.value.some(file => file.status === 'indexed')\r\n\t\tif (!hasIndexedFiles) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: 'ÊèêÁ§∫',\r\n\t\t\t\tcontent: 'È°πÁõÆÊñá‰ª∂Ê≠£Âú®Â§ÑÁêÜ‰∏≠ÔºåËØ∑Á®çÂêéÂÜçËØï',\r\n\t\t\t\tshowCancel: false,\r\n\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\textracting.value = true\r\n\t\tclearProgressTimer()\r\n\r\n\t\ttaskProgressTitle.value = '‰ø°ÊÅØÊèêÂèñ‰∏≠'\r\n\t\ttaskProgress.value = 0\r\n\t\ttaskStatusText.value = 'Ê≠£Âú®Êèê‰∫§‰ªªÂä°...'\r\n\t\ttaskState.value = 'pending'\r\n\t\t\r\n\t\tif (taskProgressModalRef) {\r\n\t\t\ttaskProgressModalRef.open()\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await runTask({\r\n\t\t\t\tprojectId: selectedProjectId.value,\r\n\t\t\t\tprojectFolder: selectedProject.value.folder_name,\r\n\t\t\t\tonProgress: (progress, statusText, state) => {\r\n\t\t\t\t\tupdateProgressSmooth(progress, statusText, state)\r\n\t\t\t\t},\r\n\t\t\t\tpollInterval: 3000,\r\n\t\t\t\ttimeout: 1800000\r\n\t\t\t})\r\n\r\n\t\t\tupdateProgressSmooth(100, '‰ªªÂä°ÂÆåÊàê', 'success')\r\n\r\n\t\t\tif (result?.status !== 'success' || !result.result) {\r\n\t\t\t\tthrow new Error(result?.message || 'ÊèêÂèñÂ§±Ë¥•ÔºöÂêéÁ´ØÊú™ËøîÂõûÊúâÊïàÊï∞ÊçÆ')\r\n\t\t\t}\r\n\r\n\t\t\tconst transformed = transformExtractResult(result.result)\r\n\t\t\t\r\n\t\t\t// È™åËØÅËΩ¨Êç¢ÁªìÊûúÊòØÊï∞ÁªÑ\r\n\t\t\tif (!Array.isArray(transformed)) {\r\n\t\t\t\tconsole.error('‚ùå transformExtractResult ËøîÂõûÁöÑ‰∏çÊòØÊï∞ÁªÑ:', typeof transformed)\r\n\t\t\t\tthrow new Error('Êï∞ÊçÆËΩ¨Êç¢Â§±Ë¥•ÔºöÁªìÊûú‰∏çÊòØÊï∞ÁªÑÊ†ºÂºè')\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tbaseTable.value = transformed\r\n\t\t\tconsole.log('‚úÖ ‰ø°ÊÅØÊèêÂèñÊàêÂäüÔºåbaseTable ÈïøÂ∫¶:', baseTable.value.length)\r\n\r\n\t\t\tconst cacheKey = `project_base_info_${selectedProjectId.value}`\r\n\t\t\tuni.setStorageSync(cacheKey, JSON.stringify(baseTable.value))\r\n\t\t\tconsole.log(`‚úÖ È°πÁõÆ ${selectedProjectId.value} ÁöÑÊï∞ÊçÆÂ∑≤ÁºìÂ≠ò`)\r\n\r\n\t\t\textractionOk.value = true\r\n\r\n\t\t\t// ÂÖ≥Èó≠ÂºπÁ™ó\r\n\t\t\tif (taskProgressModalRef) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\ttaskProgressModalRef.close()\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '‰ø°ÊÅØÊèêÂèñÂÆåÊàê',\r\n\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\r\n\t\t} catch (error) {\r\n\t\t\tclearProgressTimer()\r\n\t\t\tif (taskProgressModalRef) {\r\n\t\t\t\ttaskProgressModalRef.close()\r\n\t\t\t}\r\n\r\n\t\t\tconsole.error('[Extract] ÊèêÂèñÂ§±Ë¥•:', error)\r\n\r\n\t\t\tif (error.message.includes('Ë∂ÖÊó∂') || error.message.includes('timeout')) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: 'ÊèêÂèñË∂ÖÊó∂‰∫ÜÔºÅ',\r\n\t\t\t\t\tcontent: '‰ªªÂä°ÊâßË°åÊó∂Èó¥ËøáÈïøÔºåÂèØËÉΩÂéüÂõ†Ôºö\\n1. ÊñáÊ°£ËøáÂ§ßÔºàÂª∫ËÆÆ<50MBÔºâ\\n2. ÁΩëÁªú‰∏çÁ®≥ÂÆö\\n3. ÊúçÂä°Âô®ÁπÅÂøô\\n\\nÂª∫ËÆÆÁ®çÂêéÈáçËØïÊàñËÅîÁ≥ªÁÆ°ÁêÜÂëò',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t\t})\r\n\t\t\t} else if (error.message.includes('Êú™ÊèêÂèñÂà∞')) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: 'ÊèêÂèñÂ§±Ë¥•',\r\n\t\t\t\t\tcontent: 'ÊñáÊ°£‰∏≠Êú™ÊâæÂà∞È°πÁõÆ‰ø°ÊÅØÔºåËØ∑Ê£ÄÊü•Ôºö\\n1. Êñá‰ª∂ÊòØÂê¶‰∏∫ÂÆåÊï¥ÁöÑÁéØËØÑÊä•Âëä\\n2. Êñá‰ª∂ÂÜÖÂÆπÊòØÂê¶Ê∏ÖÊô∞ÂèØËØª\\n3. Êñá‰ª∂Ê†ºÂºèÊòØÂê¶Ê≠£Á°Æ',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t\t})\r\n\t\t\t} else if (error.message.includes('Â∑≤Êúâ‰ªªÂä°Âú®ËøêË°å')) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '‰ªªÂä°ËøõË°å‰∏≠',\r\n\t\t\t\t\tcontent: 'ÊÇ®Â∑≤Êúâ‰∏Ä‰∏™‰ø°ÊÅØÊèêÂèñ‰ªªÂä°Ê≠£Âú®ËøêË°åÔºåËØ∑Á≠âÂæÖÂÆåÊàêÂêéÂÜçÊèê‰∫§Êñ∞‰ªªÂä°',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: 'ÊèêÂèñÂ§±Ë¥•',\r\n\t\t\t\t\tcontent: error.message || 'Êó†Ê≥ï‰ªéÊñáÊ°£‰∏≠ÊèêÂèñÈ°πÁõÆ‰ø°ÊÅØÔºåËØ∑Á®çÂêéÈáçËØï',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tconfirmText: 'Áü•ÈÅì‰∫Ü'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\textracting.value = false\r\n\t\t}\r\n\t}\r\n\r\n\t// ===== Âü∫Êú¨‰ø°ÊÅØË°®Áõ∏ÂÖ≥ÊñπÊ≥ï =====\r\n\t\r\n\t// ÊâìÂºÄÊñ∞Â¢ûÈ°πÁõÆÂü∫Êú¨‰ø°ÊÅØÂºπÁ™ó\r\n\tfunction openAddBase() {\r\n\t\tnewBaseInfoLabel.value = ''\r\n\t\treturn true // ËøîÂõûtrueË°®Á§∫ÂèØ‰ª•ÊâìÂºÄÂºπÁ™ó\r\n\t}\r\n\r\n\t// Á°ÆËÆ§Êñ∞Â¢ûÈ°πÁõÆÂü∫Êú¨‰ø°ÊÅØ\r\n\tfunction confirmAddBaseInfo() {\r\n\t\tconst label = (newBaseInfoLabel.value || '').trim()\r\n\t\tif (!label) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'ËØ∑ËæìÂÖ•Â≠óÊÆµÂêçÁß∞',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tbaseTable.value.push({\r\n\t\t\tid: Date.now() + Math.random(),\r\n\t\t\tsection: '',\r\n\t\t\tlabel,\r\n\t\t\tvalue: '',\r\n\t\t\tsource: 'manual',\r\n\t\t\trequired: false,\r\n\t\t})\r\n\t\treturn true // ËøîÂõûtrueË°®Á§∫ÂèØ‰ª•ÂÖ≥Èó≠ÂºπÁ™ó\r\n\t}\r\n\r\n\t// ÂÖ≥Èó≠Êñ∞Â¢ûÈ°πÁõÆÂü∫Êú¨‰ø°ÊÅØÂºπÁ™ó\r\n\tfunction closeBaseInfo() {\r\n\t\treturn true\r\n\t}\r\n\r\n\t// ÂàáÊç¢ÈÄâÊã©Âà†Èô§Ê®°Âºè\r\n\tfunction toggleSelectMode() {\r\n\t\tselectMode.value = !selectMode.value\r\n\t\tif (!selectMode.value) selectedIds.value = []\r\n\t}\r\n\r\n\t// ÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ\r\n\tfunction toggleSelected(id) {\r\n\t\tconst idx = selectedIds.value.indexOf(id)\r\n\t\tif (idx > -1) selectedIds.value.splice(idx, 1)\r\n\t\telse selectedIds.value.push(id)\r\n\t}\r\n\r\n\t// Âà†Èô§ÈÄâ‰∏≠È°π\r\n\tfunction removeSelected() {\r\n\t\tif (selectedIds.value.length === 0) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÈ°π',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tuni.showModal({\r\n\t\t\ttitle: 'Á°ÆËÆ§Âà†Èô§',\r\n\t\t\tcontent: `Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedIds.value.length} È°πÂêóÔºü`,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tbaseTable.value = baseTable.value.filter(\r\n\t\t\t\t\t\titem => !selectedIds.value.includes(item.id)\r\n\t\t\t\t\t)\r\n\t\t\t\t\tselectedIds.value = []\r\n\t\t\t\t\tselectMode.value = false\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'Âà†Èô§ÊàêÂäü',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// ===== Ê†áËØÜÁâåÁõ∏ÂÖ≥ÊñπÊ≥ï =====\r\n\t\r\n\t// ‰ªébaseTable‰∏≠ÊèêÂèñÂü∫Êú¨‰ø°ÊÅØ\r\n\tfunction findBaseValue(label) {\r\n\t\tconst r = baseTable.value.find(x => x.label === label)\r\n\t\treturn r ? (r.value || '') : ''\r\n\t}\r\n\r\n\t// ÁîüÊàêÊ†áËØÜÁâå‰ø°ÊÅØ(‰ªéÈ°πÁõÆÂü∫Êú¨‰ø°ÊÅØÊèêÂèñ)\r\n\tfunction generateSignboard() {\r\n\t\tconst unitName = findBaseValue('Âª∫ËÆæÂçï‰ΩçÂêçÁß∞') || findBaseValue('Âçï‰ΩçÂêçÁß∞') || ''\r\n\t\tconst emissionData = baseTable.value.find(x => x.id === 'pollutants_emission')?.value\r\n\r\n\t\tif (!emissionData || typeof emissionData !== 'object') {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'Êú™ÊèêÂèñÂà∞Ê±°ÊüìÁâ©‰ø°ÊÅØ',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Ê∏ÖÁ©∫ÊóßÊï∞ÊçÆ\r\n\t\tsignboard.sections.forEach(sec => (sec.items = []))\r\n\r\n\t\t// ËæÖÂä©ÂáΩÊï∞ÔºöÊãÜÂàÜÊéíÊ±°Âè£ÁºñÂè∑\r\n\t\tfunction splitOutletCodes(codeStr) {\r\n\t\t\tif (!codeStr) return []\r\n\t\t\tconst invalidCodes = ['/', '‰ø°ÊÅØÂæÖË°•ÂÖÖ', '']\r\n\t\t\treturn codeStr\r\n\t\t\t\t.split(/[„ÄÅ,Ôºå;Ôºõ]/)\r\n\t\t\t\t.map(c => c.trim())\r\n\t\t\t\t.filter(c => c && !invalidCodes.includes(c))\r\n\t\t}\r\n\r\n\t\t// ËæÖÂä©ÂáΩÊï∞ÔºöÊåâÊéíÊ±°Âè£ÁºñÂè∑ÂàÜÁªÑÂπ∂ÂêàÂπ∂Ê±°ÊüìÂõ†Â≠ê\r\n\t\tfunction groupByOutletCode(list) {\r\n\t\t\tconst outletMap = new Map()\r\n\t\t\tlist.forEach(item => {\r\n\t\t\t\tconst codes = splitOutletCodes(item['ÊéíÊ±°Âè£ÁºñÂè∑'])\r\n\t\t\t\tconst wryz = item['Ê±°ÊüìÂõ†Â≠ê'] || ''\r\n\r\n\t\t\t\tcodes.forEach(code => {\r\n\t\t\t\t\tif (!outletMap.has(code)) {\r\n\t\t\t\t\t\toutletMap.set(code, {\r\n\t\t\t\t\t\t\tfactors: new Set(),\r\n\t\t\t\t\t\t\totherInfo: item\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (wryz) {\r\n\t\t\t\t\t\tconst factors = wryz.split(/[„ÄÅ,Ôºå;Ôºõ]/).map(f => f.trim()).filter(f => f)\r\n\t\t\t\t\t\tfactors.forEach(factor => outletMap.get(code).factors.add(factor))\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\treturn outletMap\r\n\t\t}\r\n\r\n\t\t// ËæÖÂä©ÂáΩÊï∞ÔºöÁîüÊàêÊ†áËØÜÁâåÈ°π\r\n\t\tfunction generateSignboardItems(pollutantList, blockName) {\r\n\t\t\tconst outlets = groupByOutletCode(pollutantList)\r\n\t\t\tconst section = signboard.sections.find(s => s.block === blockName)\r\n\r\n\t\t\toutlets.forEach((data, code) => {\r\n\t\t\t\tconst factors = Array.from(data.factors).join('„ÄÅ')\r\n\t\t\t\tsection.items.push(\r\n\t\t\t\t\t{ title: 'Âçï‰ΩçÂêçÁß∞', content: unitName },\r\n\t\t\t\t\t{ title: 'ÊéíÊîæÂè£ÁºñÂè∑', content: code },\r\n\t\t\t\t\t{ title: 'Ê±°ÊüìÂõ†Â≠ê', content: factors || (blockName === 'Âô™Â£∞' ? 'ËÆæÂ§áÂô™Â£∞' : 'Êú™ÊèêÂèñÂà∞Ê±°ÊüìÂõ†Â≠ê') }\r\n\t\t\t\t)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// ÁîüÊàêÂ∫üÊ∞¥Ê†áËØÜÁâå\r\n\t\tconst waterList = emissionData['Ê∞¥Ê±°ÊüìÁâ©'] || []\r\n\t\tif (waterList.length > 0) {\r\n\t\t\tgenerateSignboardItems(waterList, 'Â∫üÊ∞¥')\r\n\t\t}\r\n\r\n\t\t// ÁîüÊàêÂ∫üÊ∞îÊ†áËØÜÁâå\r\n\t\tconst gasList = emissionData['Â§ßÊ∞îÊ±°ÊüìÁâ©'] || []\r\n\t\tif (gasList.length > 0) {\r\n\t\t\tgenerateSignboardItems(gasList, 'Â∫üÊ∞î')\r\n\t\t}\r\n\r\n\t\t// ÁîüÊàêÂô™Â£∞Ê†áËØÜÁâå\r\n\t\tconst noiseList = emissionData['Âô™Â£∞'] || []\r\n\t\tif (noiseList.length > 0) {\r\n\t\t\tgenerateSignboardItems(noiseList, 'Âô™Â£∞')\r\n\t\t}\r\n\r\n\t\t// Âç±Èô©Â∫üÁâ©\r\n\t\tconst hazardousWasteList = emissionData['Âç±Èô©Â∫üÁâ©'] || []\r\n\r\n\t\tfunction extractWasteNames(wasteList) {\r\n\t\t\tif (!Array.isArray(wasteList) || wasteList.length === 0) {\r\n\t\t\t\treturn 'ÂÆûÈ™åÂÆ§Â∫üÂºÉÁâ©„ÄÅÂÆûÈ™åÂÆ§Â∫üÊ∞¥Ê±°Ê≥•„ÄÅÂåªÁñóÂ∫üÁâ©„ÄÅÂ∫üÊ¥ªÊÄßÁÇ≠'\r\n\t\t\t}\r\n\t\t\tconst names = new Set()\r\n\t\t\twasteList.forEach(item => {\r\n\t\t\t\tconst name = item['Â∫üÁâ©ÂêçÁß∞'] || ''\r\n\t\t\t\tif (name) names.add(name.trim())\r\n\t\t\t})\r\n\t\t\treturn names.size > 0 ? Array.from(names).join('„ÄÅ') : 'ÂÆûÈ™åÂÆ§Â∫üÂºÉÁâ©„ÄÅÂÆûÈ™åÂÆ§Â∫üÊ∞¥Ê±°Ê≥•„ÄÅÂåªÁñóÂ∫üÁâ©„ÄÅÂ∫üÊ¥ªÊÄßÁÇ≠'\r\n\t\t}\r\n\r\n\t\tfunction extractAllHazardCodes(wasteList) {\r\n\t\t\tif (!Array.isArray(wasteList) || wasteList.length === 0) {\r\n\t\t\t\treturn 'HW49'\r\n\t\t\t}\r\n\t\t\tconst codes = new Set()\r\n\t\t\twasteList.forEach(item => {\r\n\t\t\t\tconst category = item['Âç±Èô©Â∫üÁâ©Á±ªÂà´'] || ''\r\n\t\t\t\tif (category) {\r\n\t\t\t\t\tconst matches = category.match(/HW\\d+/g)\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tmatches.forEach(code => codes.add(code))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn codes.size > 0 ? Array.from(codes).join('„ÄÅ') : 'HW49'\r\n\t\t}\r\n\r\n\t\tfunction extractAllHazardProperties(wasteList) {\r\n\t\t\tif (!Array.isArray(wasteList) || wasteList.length === 0) {\r\n\t\t\t\treturn 'ÊØíÊÄß„ÄÅËÖêËöÄÊÄß'\r\n\t\t\t}\r\n\t\t\tconst properties = new Set()\r\n\t\t\twasteList.forEach(item => {\r\n\t\t\t\tconst hazard = item['Âç±Èô©ÁâπÊÄß'] || ''\r\n\t\t\t\tif (hazard) {\r\n\t\t\t\t\tconst matches = hazard.match(/Ôºà([^Ôºâ]+)Ôºâ/g)\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tmatches.forEach(m => {\r\n\t\t\t\t\t\t\tconst prop = m.replace(/[ÔºàÔºâ]/g, '').trim()\r\n\t\t\t\t\t\t\tif (prop) properties.add(prop)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn properties.size > 0 ? Array.from(properties).join('„ÄÅ') : 'ÊØíÊÄß„ÄÅËÖêËöÄÊÄß'\r\n\t\t}\r\n\r\n\t\tconst WFItems = [\r\n\t\t\t{ title: '‰∏ªË¶ÅÊàêÂàÜ', content: extractAllHazardCodes(hazardousWasteList) },\r\n\t\t\t{ title: 'ÂåñÂ≠¶ÂêçÁß∞', content: extractWasteNames(hazardousWasteList) },\r\n\t\t\t{ title: 'Âç±Èô©ÊÉÖÂÜµ', content: extractAllHazardProperties(hazardousWasteList) },\r\n\t\t\t{ title: 'ÂÆâÂÖ®Êé™ÊñΩ', content: 'Êé•Ëß¶Êó∂‰Ω©Êà¥‰∏™‰∫∫Èò≤Êä§Áî®ÂìÅÔºàÂÖ®Èù¢ÁΩ©/‰∏ÅÊô¥ÊâãÂ•óÔºâ' },\r\n\t\t\t{ title: 'Â∫üÁâ©‰∫ßÁîüÂçï‰Ωç', content: unitName },\r\n\t\t\t{ title: 'Âú∞ÂùÄ', content: findBaseValue('Âª∫ËÆæÂú∞ÁÇπ') },\r\n\t\t\t{ title: 'ÁîµËØù', content: findBaseValue('ËÅîÁ≥ªÊñπÂºè') },\r\n\t\t\t{ title: 'ËÅîÁ≥ª‰∫∫', content: findBaseValue('Âçï‰ΩçËÅîÁ≥ª‰∫∫') },\r\n\t\t]\r\n\t\tsignboard.sections.find(s => s.block === 'Âç±Èô©Â∫üÁâ©').items = WFItems\r\n\r\n\t\tuni.showToast({\r\n\t\t\ttitle: 'Â∑≤ÁîüÊàêÊ†áËØÜÁâå',\r\n\t\t\ticon: 'success'\r\n\t\t})\r\n\t}\r\n\r\n\t// Ê∑ªÂä†‰∏ÄÁªÑÊéíÊ±°Ê†áËØÜÁâåÔºàÂè™ÂÖÅËÆ∏Âô™Â£∞Êñ∞Â¢ûÔºâ\r\n\tfunction addSignItem(sectionIdx) {\r\n\t\tconst sec = signboard.sections[sectionIdx]\r\n\t\tconst block = sec.block\r\n\t\tconst unitName = findBaseValue('Âª∫ËÆæÂçï‰ΩçÂêçÁß∞') || findBaseValue('Âçï‰ΩçÂêçÁß∞') || ''\r\n\r\n\t\tif (block !== 'Âô™Â£∞') {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: 'Âè™ÊúâÂô™Â£∞ÂèØ‰ª•ÊâãÂä®Êñ∞Â¢û',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet maxNum = 0\r\n\t\tfor (let i = 0; i < sec.items.length; i += 3) {\r\n\t\t\tconst codeItem = sec.items[i + 1]\r\n\t\t\tif (codeItem && codeItem.title === 'ÊéíÊîæÂè£ÁºñÂè∑') {\r\n\t\t\t\tconst code = codeItem.content || ''\r\n\t\t\t\tconst match = code.match(/\\d+/)\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tconst num = parseInt(match[0], 10)\r\n\t\t\t\t\tif (num > maxNum) maxNum = num\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet code = ''\r\n\t\tif (block === 'Â∫üÊ∞¥') code = `DW${String(maxNum + 1).padStart(3,'0')}`\r\n\t\telse if (block === 'Â∫üÊ∞î') code = `DA${String(maxNum + 1).padStart(3,'0')}`\r\n\t\telse if (block === 'Âô™Â£∞') code = `ZS-${String(maxNum + 1).padStart(2,'0')}`\r\n\r\n\t\tconst group = [\r\n\t\t\t{ title: 'Âçï‰ΩçÂêçÁß∞', content: unitName },\r\n\t\t\t{ title: 'ÊéíÊîæÂè£ÁºñÂè∑', content: code },\r\n\t\t\t{ title: 'Ê±°ÊüìÂõ†Â≠ê', content: 'ËÆæÂ§áÂô™Â£∞' }\r\n\t\t]\r\n\r\n\t\tsec.items.push(...group)\r\n\r\n\t\tuni.showToast({\r\n\t\t\ttitle: 'Â∑≤Ê∑ªÂä†Êñ∞ÊéíÊ±°Âè£',\r\n\t\t\ticon: 'success'\r\n\t\t})\r\n\t}\r\n\r\n\t// ÊåâÂùóÂÜ≥ÂÆöÊòØÂê¶ 3 Êù°‰∏ÄÁªÑ\r\n\tfunction groupItems(items, block) {\r\n\t\tif (block === 'Âç±Èô©Â∫üÁâ©') return [items]\r\n\t\tconst groups = []\r\n\t\tfor (let i = 0; i < items.length; i += 3) {\r\n\t\t\tgroups.push(items.slice(i, i + 3))\r\n\t\t}\r\n\t\treturn groups\r\n\t}\r\n\r\n\t// Âà†Èô§ÊåáÂÆöÁªÑÊ†áËØÜÁâå‰ø°ÊÅØ\r\n\tfunction removeGroup(section, groupIndex) {\r\n\t\tconst start = groupIndex * 3\r\n\t\tconst codeItem = section.items.slice(start, start + 3)\r\n\t\t\t.find(it => it.title === 'ÊéíÊîæÂè£ÁºñÂè∑')\r\n\t\tconst code = codeItem?.content || 'Êú™Áü•ÁºñÂè∑'\r\n\r\n\t\tuni.showModal({\r\n\t\t\ttitle: 'Ê∞∏‰πÖÂà†Èô§',\r\n\t\t\tcontent: `Á°ÆÂÆöÂà†Èô§ÊéíÊ±°Âè£  ${code}  ÊâÄÊúâ‰ø°ÊÅØÂêóÔºü`,\r\n\t\t\tconfirmText: 'Á°ÆÂÆö',\r\n\t\t\tcancelText: 'ÂèñÊ∂à',\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tsection.items.splice(start, 3)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// Ê†áËØÜÁâå‰∏ãËΩΩ\r\n\tfunction downloadSignboard() {\r\n\t\tif (!selectedProjectId.value) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: 'ÊèêÁ§∫',\r\n\t\t\t\tcontent: 'ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™È°πÁõÆ',\r\n\t\t\t\tshowCancel: false\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tuni.showLoading({\r\n\t\t\ttitle: 'Ê≠£Âú®ÁîüÊàêÊñáÊ°£‚Ä¶'\r\n\t\t})\r\n\t\t\r\n\t\tdownloadSignboardWord(signboard, selectedProjectId.value)\r\n\t\t\t.then(buf => {\r\n\t\t\t\tconst fileName = 'ÊéíÊ±°Ê†áËØÜÁâå.docx'\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\tconst blob = new Blob([buf], {\r\n\t\t\t\t\ttype: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n\t\t\t\t})\r\n\t\t\t\tconst url = URL.createObjectURL(blob)\r\n\t\t\t\tconst a = document.createElement('a')\r\n\t\t\t\ta.href = url\r\n\t\t\t\ta.download = 'ÊéíÊ±°Ê†áËØÜÁâå.docx'\r\n\t\t\t\tdocument.body.appendChild(a)\r\n\t\t\t\ta.click()\r\n\t\t\t\tdocument.body.removeChild(a)\r\n\t\t\t\tURL.revokeObjectURL(url)\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tconst filePath = `${wx.env.USER_DATA_PATH}/${fileName}`\r\n\t\t\t\twx.getFileSystemManager().writeFile({\r\n\t\t\t\t\tfilePath,\r\n\t\t\t\t\tdata: buf,\r\n\t\t\t\t\tencoding: 'binary',\r\n\t\t\t\t\tsuccess: () => wx.openDocument({\r\n\t\t\t\t\t\tfilePath,\r\n\t\t\t\t\t\tfileType: 'docx'\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tfail: e => uni.showToast({\r\n\t\t\t\t\t\ttitle: '‰øùÂ≠òÂ§±Ë¥•',\r\n\t\t\t\t\t\ticon: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\tplus.io.requestFileSystem(plus.io.PUBLIC_DOWNLOADS, fs => {\r\n\t\t\t\t\tconst fileEntry = fs.root.getFile(fileName, {\r\n\t\t\t\t\t\tcreate: true\r\n\t\t\t\t\t}, entry => {\r\n\t\t\t\t\t\tentry.createWriter(writer => {\r\n\t\t\t\t\t\t\twriter.write(buf)\r\n\t\t\t\t\t\t\twriter.onwrite = () => uni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: 'Â∑≤‰øùÂ≠òÂà∞‰∏ãËΩΩÁõÆÂΩï'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\tcontent: err.message || 'ÁîüÊàêÂ§±Ë¥•',\r\n\t\t\t\t\tshowCancel: false\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.finally(() => uni.hideLoading())\r\n\t}\r\n\r\n\t// ===== ÂàùÂßãÂåñÂíåÁîüÂëΩÂë®ÊúüÊñπÊ≥ï =====\r\n\t\r\n\t// ÂàùÂßãÂåñÔºöÈ°µÈù¢Âä†ËΩΩÊó∂Ë∞ÉÁî®\r\n\tasync function initialize() {\r\n\t\tawait loadProjects()\r\n\r\n\t\t// Â∞ùËØïÊÅ¢Â§ç‰∏äÊ¨°ÈÄâÊã©ÁöÑÈ°πÁõÆ\r\n\t\ttry {\r\n\t\t\tconst savedProjectId = uni.getStorageSync('acceptance_project_id')\r\n\r\n\t\t\tif (savedProjectId) {\r\n\t\t\t\tconst project = projectList.value.find(p => p.id === savedProjectId)\r\n\r\n\t\t\t\tif (project) {\r\n\t\t\t\t\tconsole.log('üîÑ ÊÅ¢Â§ç‰∏äÊ¨°ÈÄâÊã©ÁöÑÈ°πÁõÆ:', project.name)\r\n\t\t\t\t\tselectedProjectId.value = project.id\r\n\t\t\t\t\tselectedProject.value = project\r\n\r\n\t\t\t\t\tawait loadProjectFiles(project.id)\r\n\t\t\t\t\tstartPollingFileStatus(project.id)\r\n\t\t\t\t\tloadProjectCache(project.id)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('‚ö†Ô∏è ‰∏äÊ¨°ÈÄâÊã©ÁöÑÈ°πÁõÆÂ∑≤‰∏çÂ≠òÂú®ÔºåÊ∏ÖÈô§ÁºìÂ≠ò')\r\n\t\t\t\t\tuni.removeStorageSync('acceptance_project_id')\r\n\t\t\t\t\tuni.removeStorageSync('acceptance_project_info')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn('‚ö†Ô∏è ÊÅ¢Â§çÈ°πÁõÆÈÄâÊã©Â§±Ë¥•:', e)\r\n\t\t}\r\n\t}\r\n\r\n\t// Ê∏ÖÁêÜÔºöÈ°µÈù¢Âç∏ËΩΩÊó∂Ë∞ÉÁî®\r\n\tfunction cleanup() {\r\n\t\tstopPolling()\r\n\t\tconsole.log('üìÑ È°µÈù¢Âç∏ËΩΩÔºåÊ∏ÖÁêÜËΩÆËØ¢ÂÆöÊó∂Âô®')\r\n\t}\r\n\r\n\t// ÁõëÂê¨È°πÁõÆÂàáÊç¢\r\n\twatch(selectedProjectId, (newId, oldId) => {\r\n\t\tif (oldId && newId !== oldId) {\r\n\t\t\tstopPolling()\r\n\t\t\tconsole.log('üîÑ ÂàáÊç¢È°πÁõÆÔºåÂÅúÊ≠¢ÊóßÈ°πÁõÆÁöÑËΩÆËØ¢')\r\n\t\t}\r\n\r\n\t\tif (newId) {\r\n\t\t\tconst monitorPlanState = useMonitorPlan()\r\n\t\t\tmonitorPlanState.loadPlanCache(newId)\r\n\t\t\t\r\n\t\t\tconst acceptanceReportState = useAcceptanceReport()\r\n\t\t\tacceptanceReportState.loadReportCache(newId)\r\n\t\t}\r\n\t})\r\n\r\n\t// ÂàõÂª∫ÂÆû‰æãÂØπË±°\r\n\tinstance = {\r\n\t\t// ===== Áä∂ÊÄÅ =====\r\n\t\t// È°πÁõÆÈÄâÊã©\r\n\t\tselectedProjectId,\r\n\t\tselectedProject,\r\n\t\tprojectList,\r\n\t\tprojectFiles,\r\n\t\tprojectSearchKeyword,\r\n\t\tfilteredProjects,\r\n\t\t\r\n\t\t// ‰ø°ÊÅØÊèêÂèñ\r\n\t\textracting,\r\n\t\textractionOk,\r\n\t\tbaseTable,\r\n\t\ttaskProgressTitle,\r\n\t\ttaskProgress,\r\n\t\ttaskStatusText,\r\n\t\ttaskState,\r\n\t\t\r\n\t\t// Âü∫Êú¨‰ø°ÊÅØË°®\r\n\t\tnewBaseInfoLabel,\r\n\t\tselectMode,\r\n\t\tselectedIds,\r\n\t\t\r\n\t\t// Ê†áËØÜÁâå\r\n\t\tshowSignboard,\r\n\t\tsignboard,\r\n\r\n\t\t// ===== ÊñπÊ≥ï =====\r\n\t\t// È°πÁõÆÈÄâÊã©\r\n\t\tloadProjects,\r\n\t\tloadProjectFiles,\r\n\t\topenProjectPicker,\r\n\t\tcloseProjectPicker,\r\n\t\tselectProject,\r\n\t\tonSearchInput,\r\n\t\t\r\n\t\t// Êñá‰ª∂ËΩÆËØ¢\r\n\t\tstartPollingFileStatus,\r\n\t\tstopPolling,\r\n\t\thasProcessingFiles,\r\n\t\t\r\n\t\t// Êñá‰ª∂Â∑•ÂÖ∑\r\n\t\tgetFileIcon,\r\n\t\tformatFileSize,\r\n\t\tformatFileStatus,\r\n\t\tgetStatusText,\r\n\t\tgetStatusClass,\r\n\t\t\r\n\t\t// ÁºìÂ≠òÁÆ°ÁêÜ\r\n\t\tloadProjectCache,\r\n\t\tclearProjectCache,\r\n\t\t\r\n\t\t// ‰ø°ÊÅØÊèêÂèñ\r\n\t\tsimulateExtract,\r\n\t\tupdateProgressSmooth,\r\n\t\tclearProgressTimer,\r\n\t\t\r\n\t\t// Âü∫Êú¨‰ø°ÊÅØË°®\r\n\t\topenAddBase,\r\n\t\tconfirmAddBaseInfo,\r\n\t\tcloseBaseInfo,\r\n\t\ttoggleSelectMode,\r\n\t\ttoggleSelected,\r\n\t\tremoveSelected,\r\n\t\t\r\n\t\t// Ê†áËØÜÁâå\r\n\t\tgenerateSignboard,\r\n\t\taddSignItem,\r\n\t\tgroupItems,\r\n\t\tremoveGroup,\r\n\t\tdownloadSignboard,\r\n\t\tfindBaseValue,\r\n\t\t\r\n\t\t// ÁîüÂëΩÂë®Êúü\r\n\t\tinitialize,\r\n\t\tcleanup\r\n\t}\r\n\r\n\treturn instance\r\n}\r\n"],"names":["ref","reactive","computed","getProjects","uni","getProjectDocuments","transformExtractResult","useFieldSurveyData","useMonitorPlan","useAcceptanceReport","runTask","code","downloadSignboardWord","wx","watch"],"mappings":"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"}