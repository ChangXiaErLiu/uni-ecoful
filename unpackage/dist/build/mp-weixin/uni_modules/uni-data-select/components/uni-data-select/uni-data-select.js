"use strict";const e=require("../../../../common/vendor.js"),t={name:"uni-data-select",mixins:[e.tr.mixinDatacom||{}],emits:["open","close","update:modelValue","input","clear","change"],model:{prop:"modelValue",event:"update:modelValue"},options:{virtualHost:!0},props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number,Array],default:""},modelValue:{type:[String,Number,Array],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""},placement:{type:String,default:"bottom"},multiple:{type:Boolean,default:!1},wrap:{type:Boolean,default:!1},align:{type:String,default:"left"},hideRight:{type:Boolean,default:!1},mode:{type:String,default:"default"}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,t={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return t?e+t:e},valueCom(){return""===this.value?this.modelValue:(this.modelValue,this.value)},textShow(){if(this.multiple){const e=this.getCurrentValues();if(Array.isArray(e)&&e.length>0){return this.mixinDatacomResData.filter((t=>e.includes(t.value))).map((e=>this.formatItemName(e))).join(", ")}return""}return this.current},shouldShowClear(){if(this.multiple){const e=this.getCurrentValues();return Array.isArray(e)&&e.length>0}return!!this.current},shouldWrap(){return this.multiple&&this.wrap&&!!this.textShow},getOffsetByPlacement(){switch(this.placement){case"top":return"bottom:calc(100% + 12px);";case"bottom":return"top:calc(100% + 12px);"}},slotSelected(){return!!this.$slots&&this.$slots.selected},slotEmpty(){return!!this.$slots&&this.$slots.empty},slotOption(){return!!this.$slots&&this.$slots.option}},watch:{showSelector:{handler(e,t){e?this.$emit("open"):this.$emit("close")}},localdata:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.mixinDatacomResData=e)}},valueCom(e,t){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{getSelectedItems(){const e=this.getCurrentValues();let t=this.mixinDatacomResData;return t=JSON.parse(JSON.stringify(this.mixinDatacomResData)),this.multiple?t.filter((t=>e.includes(t.value)))||[]:t.filter((t=>t.value===e))||[]},debounce(e,t=100){let a=null;return function(...i){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,i)}),t)}},isSelected(e){if(this.multiple){const t=this.getCurrentValues();return Array.isArray(t)&&t.includes(e.value)}return this.getCurrentValues()===e.value},getCurrentValues(){return this.multiple?Array.isArray(this.valueCom)?this.valueCom:this.valueCom?[this.valueCom]:[]:this.valueCom},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e=this.multiple?[]:"";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let t;if(this.collection&&(t=this.getCache()),t||0===t)e=t;else{let t=this.multiple?[]:"";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(t=this.multiple?[this.mixinDatacomResData[this.defItem-1].value]:this.mixinDatacomResData[this.defItem-1].value),e=t}(e||0===e||this.multiple&&Array.isArray(e)&&e.length>0)&&this.emit(e)}else e=this.valueCom;if(this.multiple){const t=Array.isArray(e)?e:e?[e]:[],a=this.mixinDatacomResData.filter((e=>t.includes(e.value)));this.current=a.map((e=>this.formatItemName(e)))}else{const t=this.mixinDatacomResData.find((t=>t.value===e));this.current=t?this.formatItemName(t):""}},isDisabled(e){if(Array.isArray(e))return e.some((e=>this.mixinDatacomResData.some((t=>t.value===e&&t.disable))));{let t=!1;return this.mixinDatacomResData.forEach((a=>{a.value===e&&(t=a.disable)})),t}},clearVal(){const e=this.multiple?[]:"";this.emit(e),this.current=this.multiple?[]:"",this.collection&&this.removeCache(),this.$emit("clear")},checkBoxChange(e){let t=e.detail.value,a=t&&t.length>0?t.map((e=>{const t=parseInt(e,10);return isNaN(t)&&console.error(`无效索引: ${e}`),(t<0||t>=this.mixinDatacomResData.length)&&console.error(`索引越界: ${t}`),this.mixinDatacomResData[t].value})):[];const i=this.mixinDatacomResData.filter((e=>a.includes(e.value)));this.current=i.map((e=>this.formatItemName(e))),this.emit(a)},change(e){if(!e.disable)if(this.multiple){let t=this.getCurrentValues();Array.isArray(t)||(t=t?[t]:[]);const a=e.value,i=t.indexOf(a);i>-1?t.splice(i,1):t.push(a);const l=this.mixinDatacomResData.filter((e=>t.includes(e.value)));this.current=l.map((e=>this.formatItemName(e))),this.emit(t)}else this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value)},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:t,value:a,channel_code:i}=e;if(i=i?`(${i})`:"",this.format){let t="";t=this.format;for(let a in e)t=t.replace(new RegExp(`{${a}}`,"g"),e[a]);return t}return this.collection.indexOf("app-list")>0?`${t}(${a})`:t||`未命名${i}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(t=this.getCurrentCacheKey()){return(e.index.getStorageSync(this.cacheKey)||{})[t]},setCache(t,a=this.getCurrentCacheKey()){let i=e.index.getStorageSync(this.cacheKey)||{};i[a]=t,e.index.setStorageSync(this.cacheKey,i)},removeCache(t=this.getCurrentCacheKey()){let a=e.index.getStorageSync(this.cacheKey)||{};delete a[t],e.index.setStorageSync(this.cacheKey,a)}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const a=e._export_sfc(t,[["render",function(t,a,i,l,s,o){return e.e({a:i.label},i.label?{b:e.t(i.label+"：")}:{},{c:o.slotSelected},o.slotSelected?{d:e.r("selected",{selectedItems:o.getSelectedItems()}),e:o.shouldWrap?1:""}:e.e({f:o.textShow},o.textShow?{g:e.t(o.textShow),h:e.n("align-"+i.align),i:o.shouldWrap?1:""}:{j:e.t(o.typePlaceholder),k:e.n("align-"+i.align)}),{l:!i.hideRight&&o.shouldShowClear&&i.clear&&!i.disabled},!i.hideRight&&o.shouldShowClear&&i.clear&&!i.disabled?{m:e.p({type:"clear",color:"#c0c4cc",size:"24"}),n:e.o(((...e)=>o.clearVal&&o.clearVal(...e)))}:i.hideRight?{}:{p:e.p({type:s.showSelector?"top":"bottom",size:"14",color:"#999"})},{o:!i.hideRight,q:e.o(((...e)=>o.toggleSelector&&o.toggleSelector(...e))),r:o.shouldWrap?1:"",s:s.showSelector},s.showSelector?{t:e.o(((...e)=>o.toggleSelector&&o.toggleSelector(...e)))}:{},{v:s.showSelector},s.showSelector?e.e({w:e.n("bottom"==i.placement?"uni-popper__arrow_bottom":"uni-popper__arrow_top"),x:o.slotEmpty&&0===s.mixinDatacomResData.length},o.slotEmpty&&0===s.mixinDatacomResData.length?{y:e.r("empty",{empty:i.emptyTips})}:e.e({z:0===s.mixinDatacomResData.length},0===s.mixinDatacomResData.length?{A:e.t(i.emptyTips)}:{}),{B:o.slotOption},o.slotOption?{C:e.f(s.mixinDatacomResData,((t,a,l)=>({a:"option-"+l,b:e.r("option",{item:t,itemSelected:i.multiple?o.getCurrentValues().includes(t.value):o.getCurrentValues()==t.value},l),c:a,d:e.o((e=>o.change(t)),a)})))}:e.e({D:!i.multiple&&s.mixinDatacomResData.length>0},!i.multiple&&s.mixinDatacomResData.length>0?{E:e.f(s.mixinDatacomResData,((t,a,i)=>({a:e.t(o.formatItemName(t)),b:t.disable?1:"",c:a,d:e.o((e=>o.change(t)),a)})))}:{},{F:i.multiple&&s.mixinDatacomResData.length>0},i.multiple&&s.mixinDatacomResData.length>0?{G:e.f(s.mixinDatacomResData,((t,a,i)=>({a:a+"",b:o.getCurrentValues().includes(t.value),c:t.disable,d:e.t(o.formatItemName(t)),e:t.disable?1:"",f:a}))),H:e.o(((...e)=>o.checkBoxChange&&o.checkBoxChange(...e)))}:{}),{I:e.s(o.getOffsetByPlacement)}):{},{J:i.disabled?1:"",K:o.shouldWrap?1:"",L:"default"==i.mode?1:"",M:"underline"==i.mode?1:"",N:s.current?1:""})}]]);wx.createComponent(a);
