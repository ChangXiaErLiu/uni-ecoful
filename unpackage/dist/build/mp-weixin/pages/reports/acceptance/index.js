"use strict";const e=require("../../../common/vendor.js"),l=require("../../../utils/platform.js"),o=require("../../../stores/navTitle.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+t+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t=()=>"../../../components/layout/AppLayout.js",a={__name:"index",setup(t){const a=o.navTitleStore();e.onShow((()=>a.setTitle("验收报告")));const{isMobile:n}=l.usePlatformInfo(),u=["上传&提取","提资单","业主比对","差异比对","标识牌","监测方案","最终生成"],i=e.ref(0);e.computed((()=>u.map(((e,l)=>b(l)?e+" ✓":e))));const s=e.computed((()=>u.map(((e,l)=>({text:b(l)?e+" ✓":e,value:l})))));function c(){i.value>0&&(i.value-=1)}function r(){i.value<u.length-1&&(i.value+=1)}const p=e.ref([]);function d(){const l=Date.now();P.value=[{id:l+1,label:"项目名称",value:"某产业园环保技改项目",unit:"",source:"extract",required:!0,status:"pending"},{id:l+2,label:"单位名称",value:"广州市南沙新区产业园区开发建设管理局",unit:"",source:"extract",required:!0,status:"pending"},{id:l+3,label:"项目地址",value:"广州市南沙区××路×号",unit:"",source:"extract",required:!0,status:"pending"},{id:l+4,label:"联系人",value:"张三",unit:"",source:"extract",required:!1,status:"pending"},{id:l+5,label:"联系电话",value:"",unit:"",source:"extract",required:!1,status:"require"},{id:l+6,label:"环评/批复编号",value:"环批〔2024〕001号",unit:"",source:"extract",required:!0,status:"pending"},{id:l+7,label:"主要产品与规模",value:"产品A 年产1000吨",unit:"",source:"extract",required:!0,status:"pending"},{id:l+8,label:"纬度",value:"23.12",unit:"°",source:"extract",required:!1,status:"pending"},{id:l+9,label:"经度",value:"113.22",unit:"°",source:"extract",required:!1,status:"pending"},{id:l+10,section:"法规标准",label:"验收依据",value:"建设项目竣工环境保护验收暂行办法",unit:"",source:"extract",required:!0,status:"pending"}],f.value=!0,e.index.showToast({title:`提取完成（示例 ${P.value.length} 项）`,icon:"success"})}function v(){p.value=[],f.value=!1,h.value=!1}const f=e.ref(!1),h=e.ref(!1);function b(e){return 0===e&&f.value}function m(){e.index.showToast({title:"草稿已保存",icon:"success"})}const g=e.ref(null),x=e.ref("export"),y=e.ref(""),z=e.ref(null),w=e.ref("");function q(){var l,o;try{x.value="export",y.value=JSON.stringify({step:i.value},null,2),null==(o=null==(l=g.value)?void 0:l.open)||o.call(l)}catch(t){e.index.showToast({title:"导出失败",icon:"none"})}}function T(){var e,l;x.value="import",y.value="",null==(l=null==(e=g.value)?void 0:e.open)||l.call(e)}function k(){var e,l;null==(l=null==(e=g.value)?void 0:e.close)||l.call(e)}function j(){var l,o;try{null==(o=null==(l=g.value)?void 0:l.close)||o.call(l),e.index.showToast({title:"导入完成",icon:"success"})}catch(t){e.index.showToast({title:"JSON 不合法",icon:"none"})}}function M(){var l,o;try{e.index.setClipboardData({data:y.value||""}),e.index.showToast({title:"已复制",icon:"none"}),null==(o=null==(l=g.value)?void 0:l.close)||o.call(l)}catch(t){e.index.showToast({title:"复制失败",icon:"none"})}}function V(){p.value=[],f.value=!1,i.value=0,e.index.showToast({title:"已清空",icon:"none"})}function _(){e.index.showToast({title:"导出Word（占位）",icon:"none"})}function C(){e.index.showToast({title:"导出PDF（占位）",icon:"none"})}function S(){var e,l;w.value="",null==(l=null==(e=z.value)?void 0:e.open)||l.call(e)}function D(){var e,l;null==(l=null==(e=z.value)?void 0:e.close)||l.call(e)}function J(){var l,o;const t=(w.value||"").trim();t?(P.value.push({id:Date.now()+Math.random(),section:"",label:t,value:"",unit:"",source:"manual",required:!1,status:"pending"}),null==(o=null==(l=z.value)?void 0:l.close)||o.call(l)):e.index.showToast({title:"请输入字段名称",icon:"none"})}const O=[{text:"待核对",value:"pending"},{text:"已核对",value:"verified"},{text:"需补充",value:"require"}],P=e.ref([]),A=e.ref([]),N=[{text:"需再次提资",value:"requireMore"},{text:"需业主核对",value:"ownerConfirm"}];function I(){const l=P.value.filter((e=>e.required&&!e.value||"verified"!==e.status)).map((e=>({id:e.id,label:e.label||"未命名",value:e.value||"",type:e.required&&!e.value?"requireMore":"ownerConfirm",status:"pending"})));A.value=l,e.index.showToast({title:`已生成提资单（${l.length}项）`,icon:"none"})}function L(){e.index.showToast({title:"待对接：导出提资单",icon:"none"})}const $=e.ref(!1),E=e.ref([]);function F(){$.value=!$.value,$.value||(E.value=[])}function B(){E.value.length?(P.value=P.value.filter((e=>!E.value.includes(e.id))),E.value=[],$.value=!1,e.index.showToast({title:"已删除选中字段",icon:"none"})):e.index.showToast({title:"未选择字段",icon:"none"})}e.ref([]),e.ref([]),e.ref([]);const G=e.ref([]),H=e.ref([]);e.ref([]);const K=e.reactive({sections:[{block:"废水",items:[{title:"单位名称",content:""}]},{block:"噪声",items:[{title:"单位名称",content:""}]},{block:"危险污染物",items:[{title:"单位名称",content:""}]}]});function W(e){const l=P.value.find((l=>l.label===e));return l&&l.value||""}const Q=e.ref([]);function R(e){const l=[];return 0===e?p.value.length||f.value||l.push("上传至少1个文件或使用示例提取"):1===e?P.value.length||l.push("未生成项目信息表"):3===e?G.value.length||H.value.length||l.push("请完善设备或排放口"):4===e?K.sections.some((e=>e.items.some((e=>e.content))))||l.push("标识牌至少填写一项内容"):5===e&&(Q.value.length||l.push("请新增或推荐至少1条方案")),l}e.computed((()=>{const e=function(){const e=[];for(let l=0;l<u.length;l++){const o=R(l);o.length&&e.push({step:l,messages:o})}return e}();return e.length?e.map((e=>`· ${u[e.step]}：${e.messages.join("，")}`)).join("\n"):"已满足生成条件（示例）。"}));const U=e.computed((()=>{let e=0,l=0;e+=1,f.value&&(l+=1),e+=1,P.value.length>0&&(l+=1),e+=1,l+=1;const o=Math.round(l/Math.max(3,1)*100);return Math.min(100,Math.max(0,o))}));return e.onLoad((()=>{})),(l,o)=>e.e({a:U.value+"%",b:e.t(U.value),c:e.p({type:"folder",size:"16",color:"#64748b"}),d:e.o(m),e:e.p({type:"upload",size:"16",color:"#64748b"}),f:e.o(q),g:e.p({type:"download",size:"16",color:"#64748b"}),h:e.o(T),i:e.p({type:"trash",size:"16",color:"#ef4444"}),j:e.o(V),k:e.p({type:"file",size:"16",color:"#276019"}),l:e.o(_),m:e.p({type:"pdf",size:"16",color:"#ffffff"}),n:e.o(C),o:e.unref(n)},e.unref(n)?{p:e.o((e=>i.value=e)),q:e.p({localdata:s.value,placeholder:"选择步骤",modelValue:i.value})}:{r:e.f(u,((l,o,t)=>e.e({a:b(o)},b(o)?{}:{b:e.t(o+1)},{c:e.t(l),d:b(o)},(b(o),{}),{e:o,f:i.value===o?1:"",g:b(o)?1:"",h:e.o((e=>i.value=o),o)})))},{s:e.p({type:"cloud-upload",size:"20",color:"#276019"}),t:e.o((e=>p.value=e)),v:e.p({fileMediatype:"all","auto-upload":!1,limit:6,modelValue:p.value}),w:e.p({type:"search",size:"16",color:"#ffffff"}),x:e.o(d),y:e.p({type:"clear",size:"16",color:"#64748b"}),z:e.o(v),A:P.value.length},P.value.length?e.e({B:e.p({type:"list",size:"18",color:"#276019"}),C:e.p({type:"plus",size:"16",color:"#276019"}),D:e.o(S),E:e.p({type:$.value?"checkbox-filled":"checkbox",size:"16",color:"#276019"}),F:e.t($.value?"退出选择":"选择删除"),G:e.o(F),H:$.value},$.value?{I:e.p({type:"trash",size:"16",color:"#b91c1c"}),J:e.t(E.value.length),K:!E.value.length,L:e.o(B)}:{},{M:e.f(P.value,((l,o,t)=>e.e({a:e.t(l.label),b:"9be43546-16-"+t+",9be43546-0",c:e.o((e=>l.value=e),l.id),d:e.p({placeholder:"填写值",modelValue:l.value})},$.value?{e:E.value.includes(l.id),f:e.o((()=>function(e){const l=E.value,o=l.indexOf(e);o>=0?l.splice(o,1):l.push(e)}(l.id)),l.id)}:{},{g:l.id}))),N:$.value,O:e.p({type:"list",size:"18",color:"#f59e0b"}),P:e.p({type:"gear",size:"16",color:"#ffffff"}),Q:e.o((()=>{!function(){const l=W("单位名称")||W("项目名称")||"";K.sections.forEach((e=>{const o=e.items.find((e=>e.title.includes("单位名称")));o&&(o.content=l)})),e.index.showToast({title:"已生成文案（示例）",icon:"none"})}(),h.value=!0})),R:h.value},h.value?{S:e.p({type:"right",size:"16",color:"#64748b"}),T:e.o((e=>i.value=4))}:{},{U:h.value},h.value?{V:e.f(K.sections,((l,o,t)=>({a:e.t(l.block||"未命名"),b:"9be43546-20-"+t+",9be43546-0",c:e.o((()=>{return e=o,void K.sections[e].items.push({title:"单位名称",content:""});var e}),"s"+o),d:e.f(l.items,((l,a,n)=>({a:"9be43546-21-"+t+"-"+n+",9be43546-0",b:e.o((e=>l.title=e),"r"+o+"-"+a),c:e.p({placeholder:"内容标题",modelValue:l.title}),d:"9be43546-22-"+t+"-"+n+",9be43546-0",e:e.o((e=>l.content=e),"r"+o+"-"+a),f:e.p({placeholder:"内容",modelValue:l.content}),g:"9be43546-23-"+t+"-"+n+",9be43546-0",h:e.o((()=>{return e=o,l=a,void K.sections[e].items.splice(l,1);var e,l}),"r"+o+"-"+a),i:"r"+o+"-"+a}))),e:"s"+o}))),W:e.p({type:"plus",size:"16",color:"#276019"}),X:e.p({type:"trash",size:"16",color:"#ef4444"})}:{}):{},{Y:0===i.value,Z:e.p({type:"clipboard",size:"20",color:"#276019"}),aa:e.p({type:"gear",size:"16",color:"#ffffff"}),ab:e.o(I),ac:e.p({type:"clipboard",size:"18",color:"#f59e0b"}),ad:e.p({type:"download",size:"16",color:"#276019"}),ae:e.o(L),af:A.value.length},A.value.length?{ag:e.f(A.value,((l,o,t)=>({a:"9be43546-28-"+t+",9be43546-0",b:e.o((e=>l.label=e),l.id),c:e.p({placeholder:"字段名",modelValue:l.label}),d:"9be43546-29-"+t+",9be43546-0",e:e.o((e=>l.value=e),l.id),f:e.p({placeholder:"值",modelValue:l.value}),g:"9be43546-30-"+t+",9be43546-0",h:e.o((e=>l.type=e),l.id),i:e.p({localdata:N,placeholder:"类型",modelValue:l.type}),j:"9be43546-31-"+t+",9be43546-0",k:e.o((e=>l.status=e),l.id),l:e.p({localdata:O,placeholder:"状态",modelValue:l.status}),m:"9be43546-32-"+t+",9be43546-0",n:e.o((()=>function(e){A.value.splice(e,1)}(o)),l.id),o:l.id}))),ah:e.p({type:"trash",size:"16",color:"#ef4444"})}:{ai:e.p({type:"document",size:"48",color:"#cbd5e1"})},{aj:1===i.value,ak:e.p({type:"left",size:"16",color:"#64748b"}),al:0===i.value,am:e.o(c),an:e.p({type:"right",size:"16",color:"#ffffff"}),ao:i.value===u.length-1,ap:e.o(r),aq:e.p({current:"pages/reports/acceptance/index"}),ar:e.t("export"===x.value?"导出草稿":"导入草稿"),as:e.p({type:"close",size:"20",color:"#64748b"}),at:e.o(k),av:e.t("export"===x.value?"复制以下JSON数据以保存草稿":"粘贴JSON数据以导入草稿"),aw:"export"===x.value,ax:y.value,ay:e.o((e=>y.value=e.detail.value)),az:e.o(k),aA:"import"===x.value},"import"===x.value?{aB:e.o(j)}:{aC:e.o(M)},{aD:e.sr(g,"9be43546-36",{k:"draftPopup"}),aE:e.p({type:"center","background-color":"rgba(0,0,0,0.5)"}),aF:e.p({type:"close",size:"20",color:"#64748b"}),aG:e.o(D),aH:e.o((e=>w.value=e)),aI:e.p({placeholder:"如：项目名称/单位名称",modelValue:w.value}),aJ:e.o(D),aK:e.o(J),aL:e.sr(z,"9be43546-38",{k:"fieldPopup"}),aM:e.p({type:"center","background-color":"rgba(0,0,0,0.5)"})})}},n=e._export_sfc(a,[["__scopeId","data-v-9be43546"]]);wx.createPage(n);
