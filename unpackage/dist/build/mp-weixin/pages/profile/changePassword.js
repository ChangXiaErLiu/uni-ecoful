"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/navTitle.js"),t=require("../../utils/request.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+n)();const n=()=>"../../components/layout/AppLayout.js",s={__name:"changePassword",setup(n){const s=o.navTitleStore();e.onShow((()=>s.setTitle("修改密码")));const a=e.ref(null),r=e.ref({oldPwd:"",newPwd:"",confirmPwd:""}),l=e.ref(!1),u=e.computed((()=>{const e=r.value.newPwd||"";let o=0;return e.length>=8&&o++,/[A-Z]/.test(e)&&o++,/[a-z]/.test(e)&&o++,/\d/.test(e)&&o++,/[^A-Za-z0-9]/.test(e)&&o++,["很弱","较弱","一般","较强","很强"][Math.max(0,Math.min(o-1,4))]})),i={oldPwd:{required:!0,errorMessage:"请输入旧密码"},newPwd:{required:!0,errorMessage:"请输入新密码",validateFunction:(e,o,t,n)=>{const s=String(o||"");return s.length<8?n("至少8位"):/[A-Za-z]/.test(s)&&/\d/.test(s)?n():n("需包含字母和数字")}},confirmPwd:{required:!0,errorMessage:"请确认新密码",validateFunction:(e,o,t,n)=>String(o||"")!==String(r.value.newPwd||"")?n("两次输入不一致"):n()}};async function d(){var o,n;try{await(null==(n=null==(o=a.value)?void 0:o.validate)?void 0:n.call(o))}catch(s){return}l.value=!0;try{await t.request({url:"/user/password/change",method:"POST",data:{oldPwd:r.value.oldPwd,newPwd:r.value.newPwd}}),e.index.showModal({title:"修改成功",content:"是否同时下线其他设备？",success:async o=>{if(o.confirm)try{await t.request({url:"/user/sessions/logout-others",method:"POST",data:{}})}catch(s){}e.index.showToast({title:"密码已修改",icon:"success"}),setTimeout((()=>e.index.navigateBack({delta:1})),600)}})}catch(s){e.index.showToast({title:"修改失败，请稍后重试",icon:"none"})}finally{l.value=!1}}return(o,t)=>({a:e.p({type:"locked-filled",size:"20",color:"#276019"}),b:e.o((e=>r.value.oldPwd=e)),c:e.p({type:"password",placeholder:"请输入旧密码",clearable:!0,modelValue:r.value.oldPwd}),d:e.o((e=>r.value.newPwd=e)),e:e.p({type:"password",placeholder:"至少8位，含字母和数字",modelValue:r.value.newPwd}),f:e.t(u.value),g:e.o((e=>r.value.confirmPwd=e)),h:e.p({type:"password",placeholder:"请再次输入新密码",modelValue:r.value.confirmPwd}),i:e.sr(a,"969c888c-2,969c888c-0",{k:"formRef"}),j:e.p({modelValue:r.value,rules:i}),k:e.t(l.value?"提交中...":"确认修改"),l:l.value,m:e.o(d),n:e.p({current:"pages/profile/changePassword"})})}},a=e._export_sfc(s,[["__scopeId","data-v-969c888c"]]);wx.createPage(a);
