"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/navTitle.js"),n=require("../../utils/request.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+o)();const o=()=>"../../components/layout/AppLayout.js",a={__name:"feedback",setup(o){const a=t.navTitleStore();e.onShow((()=>a.setTitle("意见反馈")));const i=["功能建议","BUG问题","体验优化","其他"];let u=e.ref(0);const l=e.ref(null),r=e.ref({type:i[0],content:"",contact:""});e.watch(u,(e=>{r.value.type=i[e]}));const s=e.ref([]),c=e.ref(!1),p={content:{required:!0,errorMessage:"请填写问题描述",validateFunction:(e,t,n,o)=>{if(String(t||"").trim().length<10)return o("请至少填写10个字");o()}}};async function d(){var t,o;try{await(null==(o=null==(t=l.value)?void 0:t.validate)?void 0:o.call(t))}catch(a){return}c.value=!0;try{const t=await async function(){if(!s.value||0===s.value.length)return[];const t=[];for(const n of s.value){const o=n.url||n.path||n.tempFilePath;if(o)try{const n=await new Promise(((t,n)=>{e.index.uploadFile({url:BASE_URL+"/upload",filePath:o,name:"file",success:e=>{try{const n=JSON.parse(e.data||"{}");t(n)}catch(a){t({url:""})}},fail:n})}));(null==n?void 0:n.url)&&t.push({url:n.url,id:n.id})}catch(a){}}return t}(),o={...r.value,images:t},i=await n.request({url:"/feedback/create",method:"POST",data:o}),u=(null==i?void 0:i.ticketId)?`（单号：${i.ticketId}）`:"";e.index.showToast({title:`提交成功${u}`,icon:"success"}),setTimeout((()=>e.index.navigateBack({delta:1})),800)}catch(a){e.index.showToast({title:"提交失败，请稍后再试",icon:"none"})}finally{c.value=!1}}return(t,n)=>({a:e.p({type:"help",size:"20",color:"#276019"}),b:e.t(i[e.unref(u)]),c:i,d:e.unref(u),e:e.o((t=>e.isRef(u)?u.value=Number(t.detail.value):u=Number(t.detail.value))),f:e.o((e=>r.value.content=e)),g:e.p({type:"textarea",placeholder:"请描述您遇到的问题或建议",modelValue:r.value.content}),h:e.o((e=>r.value.contact=e)),i:e.p({placeholder:"手机号或邮箱（选填）",modelValue:r.value.contact}),j:e.o((e=>s.value=e)),k:e.p({fileMediatype:"image",mode:"grid",limit:6,modelValue:s.value}),l:e.sr(l,"bab229f2-2,bab229f2-0",{k:"formRef"}),m:e.p({modelValue:r.value,rules:p}),n:e.t(c.value?"提交中...":"提交反馈"),o:c.value,p:e.o(d),q:e.p({current:"pages/profile/feedback"})})}},i=e._export_sfc(a,[["__scopeId","data-v-bab229f2"]]);wx.createPage(i);
