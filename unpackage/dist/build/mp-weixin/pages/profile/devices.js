"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/navTitle.js"),s=require("../../utils/request.js");if(!Array){e.resolveComponent("uni-icons")()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+n)();const n=()=>"../../components/layout/AppLayout.js",o={__name:"devices",setup(n){const o=t.navTitleStore();e.onShow((()=>{o.setTitle("设备与会话"),d()}));const a=e.ref([]),i=e.ref(1),u=e.ref(!1),l=e.ref(!1),c=e.ref(!1),r=e.ref(null),v=e.ref(!1);async function d(){i.value=1,a.value=[],await f()}async function f(){var t;1===i.value&&(l.value=!0);try{const e=await s.request({url:`/user/sessions?page=${i.value}&size=20`,method:"GET"}),n=(null==e?void 0:e.list)||[];a.value=1===i.value?n:a.value.concat(n);const o=(null==(t=null==e?void 0:e.page)?void 0:t.total)||0,r=a.value.length;u.value=r<o}catch(n){1===i.value&&(a.value=[]),e.index.showToast({title:"加载失败",icon:"none"})}finally{1===i.value&&(l.value=!1),c.value=!1}}function h(){u.value&&!c.value&&(c.value=!0,i.value+=1,f())}function p(){e.index.showModal({title:"批量下线",content:"确定下线除当前设备外的所有会话？",success:async t=>{if(t.confirm){v.value=!0;try{await s.request({url:"/user/sessions/logout-others",method:"POST",data:{}}),e.index.showToast({title:"已下线其他设备",icon:"success"}),d()}catch(n){e.index.showToast({title:"操作失败",icon:"none"})}finally{v.value=!1}}}})}return(t,n)=>e.e({a:e.p({type:"phone",size:"20",color:"#276019"}),b:l.value},(l.value||a.value.length,{}),{c:0===a.value.length,d:e.f(a.value,((t,n,o)=>e.e({a:e.t(t.device||"未知设备"),b:t.isCurrent},(t.isCurrent,{}),{c:e.t(t.os||"-"),d:e.t(t.browser||"-"),e:e.t(t.ip||"-"),f:e.t(t.activeAt||"-"),g:e.t(t.isCurrent?"使用中":r.value===t.id?"处理中":"下线"),h:t.isCurrent||r.value===t.id,i:e.o((n=>function(t){t.isCurrent||e.index.showModal({title:"确认下线",content:"确定将该设备下线吗？",success:async n=>{if(n.confirm){r.value=t.id;try{await s.request({url:"/user/sessions/logout",method:"POST",data:{id:t.id}}),e.index.showToast({title:"已下线",icon:"success"}),d()}catch(o){e.index.showToast({title:"操作失败",icon:"none"})}finally{r.value=null}}}})}(t)),t.id||n),j:t.id||n}))),e:u.value},u.value?{f:e.t(c.value?"加载中...":"加载更多"),g:c.value,h:e.o(h)}:{},{i:v.value,j:e.o(p),k:e.p({current:"pages/profile/devices"})})}},a=e._export_sfc(o,[["__scopeId","data-v-39cd8d63"]]);wx.createPage(a);
