"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/safe-area.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const n={__name:"ChatInput",props:{isGenerating:{type:Boolean,default:!1}},emits:["send-message","stop-generating","clear-conversation","add-attachment"],setup(n,{expose:a,emit:i}){const o=n,s=i,{safeAreaBottomPx:l}=t.useSafeArea(),r=e.ref(0);e.onMounted((()=>{try{const t=e=>{r.value=Number((null==e?void 0:e.height)||0)};e.index.onKeyboardHeightChange&&e.index.onKeyboardHeightChange(t),r._handler=t}catch(t){}})),e.onUnmounted((()=>{try{r._handler&&"function"==typeof e.index.offKeyboardHeightChange&&e.index.offKeyboardHeightChange(r._handler)}catch(t){}}));const u=e.computed((()=>{try{const e=Number((null==r?void 0:r.value)||0);return`transform: translateY(-${e}px); padding-bottom: ${Number((null==l?void 0:l.value)||0)}px; will-change: transform;`}catch(e){return""}})),c=e.ref(""),p=e.ref([]);a({setDraft(t="",n=[]){c.value=(t||"").toString(),p.value=Array.isArray(n)?[...n]:[],e.nextTick$1()}});const m=e=>{if(null==e?void 0:e.isImage)return!0;if((null==e?void 0:e.type)&&"string"==typeof e.type&&0===e.type.indexOf("image/"))return!0;const t=((null==e?void 0:e.name)||"")+" "+((null==e?void 0:e.url)||"");return/\.(png|jpe?g|gif|bmp|webp|heic|heif)$/i.test(t)},f=e.computed((()=>!o.isGenerating&&(c.value.trim()||p.value.length>0))),d=e.computed((()=>Math.max(0,10-p.value.length))),g=e.computed((()=>d.value>0)),h=e.computed((()=>o.isGenerating||f.value?"#ffffff":"#9ca3af")),v=()=>{o.isGenerating?x():y()},y=()=>{if(!f.value)return;const e={content:c.value.trim(),attachments:[...p.value]};s("send-message",e),c.value="",p.value=[]},x=()=>s("stop-generating");function b(){g.value?e.index.showActionSheet({itemList:["选择图片","选择文件"],success:t=>{0===t.tapIndex?function(){const t=Math.min(9,d.value);e.index.chooseImage({count:t,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{_((e.tempFiles||[]).map(((t,n)=>({type:t.type||"image/*",isImage:!0,name:t.name||`image_${Date.now()}_${n}.jpg`,url:t.path||e.tempFilePaths&&e.tempFilePaths[n]||"",size:t.size||0}))))}})}():e.index.chooseMessageFile({count:Math.min(d.value,10),type:"all",success:e=>{const t=e.tempFiles||[],n=Math.min(t.length,d.value);_(t.slice(0,n).map(((e,t)=>({type:e.type||"",name:e.name||`file_${Date.now()}_${t}`,url:e.path,size:e.size||0,isImage:m(e)}))))}})}}):e.index.showToast({title:"最多只能添加 10 个附件",icon:"none"})}function _(t){for(const n of t){if(p.value.length>=10){e.index.showToast({title:"已达 10 个附件上限",icon:"none"});break}p.value.push(n)}}return(t,a)=>e.e({a:p.value.length},p.value.length?{b:e.f(p.value,((t,n,a)=>e.e({a:m(t)},m(t)?{b:t.url}:{c:"1fd387ce-0-"+a,d:e.p({type:"paperclip",size:"20",color:"#64748b"}),e:e.t(t.name)},{f:"1fd387ce-1-"+a,g:e.o((e=>(e=>p.value.splice(e,1))(n)),n),h:n}))),c:e.p({type:"close",size:"14",color:"#ffffff"})}:{},{d:-1,e:e.o(v),f:c.value,g:e.o((e=>c.value=e.detail.value)),h:e.p({type:"plus",size:"24",color:g.value?"#82AE5D":"#cbd5e1"}),i:g.value?"":1,j:e.o(b),k:e.p({type:n.isGenerating?"circle-filled":"paperplane",size:"20",color:h.value}),l:n.isGenerating?1:"",m:n.isGenerating?"":1,n:n.isGenerating||f.value?"":1,o:e.o(v),p:e.t(p.value.length),q:e.s(u.value)})}},a=e._export_sfc(n,[["__scopeId","data-v-1fd387ce"]]);wx.createComponent(a);
